<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Costin-Andrei Taulescu &amp; Panagiotis Valsamis">
<meta name="dcterms.date" content="2026-01-25">

<title>Time Series Forecasting: Walmart Sales Analysis Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Part1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Part1_files/libs/quarto-html/quarto.js"></script>
<script src="Part1_files/libs/quarto-html/popper.min.js"></script>
<script src="Part1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Part1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Part1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Part1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Part1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Part1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Part1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#reproducibility-setup" id="toc-reproducibility-setup" class="nav-link" data-scroll-target="#reproducibility-setup">Reproducibility Setup</a>
  <ul class="collapse">
  <li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup">Environment Setup</a></li>
  <li><a href="#required-libraries" id="toc-required-libraries" class="nav-link" data-scroll-target="#required-libraries">Required Libraries</a></li>
  </ul></li>
  <li><a href="#data-overview" id="toc-data-overview" class="nav-link" data-scroll-target="#data-overview">Data Overview</a>
  <ul class="collapse">
  <li><a href="#loading-the-dataset" id="toc-loading-the-dataset" class="nav-link" data-scroll-target="#loading-the-dataset">Loading the Dataset</a></li>
  <li><a href="#data-quality-handling-negative-sales" id="toc-data-quality-handling-negative-sales" class="nav-link" data-scroll-target="#data-quality-handling-negative-sales">Data Quality: Handling Negative Sales</a></li>
  </ul></li>
  <li><a href="#focus-store-1-analysis" id="toc-focus-store-1-analysis" class="nav-link" data-scroll-target="#focus-store-1-analysis">Focus: Store 1 Analysis</a>
  <ul class="collapse">
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train-Test Split</a></li>
  </ul></li>
  <li><a href="#method-2-aggregate-then-disaggregate" id="toc-method-2-aggregate-then-disaggregate" class="nav-link" data-scroll-target="#method-2-aggregate-then-disaggregate">Method 2: Aggregate-then-Disaggregate</a>
  <ul class="collapse">
  <li><a href="#step-1-aggregate-store-level-sales" id="toc-step-1-aggregate-store-level-sales" class="nav-link" data-scroll-target="#step-1-aggregate-store-level-sales">Step 1: Aggregate Store-Level Sales</a>
  <ul class="collapse">
  <li><a href="#initial-observations" id="toc-initial-observations" class="nav-link" data-scroll-target="#initial-observations">Initial Observations</a></li>
  </ul></li>
  <li><a href="#step-2-statistical-tests-for-trend" id="toc-step-2-statistical-tests-for-trend" class="nav-link" data-scroll-target="#step-2-statistical-tests-for-trend">Step 2: Statistical Tests for Trend</a></li>
  <li><a href="#step-3-holt-winters-forecasting-additive-seasonality" id="toc-step-3-holt-winters-forecasting-additive-seasonality" class="nav-link" data-scroll-target="#step-3-holt-winters-forecasting-additive-seasonality">Step 3: Holt-Winters Forecasting (Additive Seasonality)</a>
  <ul class="collapse">
  <li><a href="#grid-search-for-optimal-parameters" id="toc-grid-search-for-optimal-parameters" class="nav-link" data-scroll-target="#grid-search-for-optimal-parameters">Grid Search for Optimal Parameters</a></li>
  <li><a href="#generate-forecasts" id="toc-generate-forecasts" class="nav-link" data-scroll-target="#generate-forecasts">Generate Forecasts</a></li>
  <li><a href="#better-visualization-of-the-predictionadditive" id="toc-better-visualization-of-the-predictionadditive" class="nav-link" data-scroll-target="#better-visualization-of-the-predictionadditive">Better Visualization of the prediction(Additive)</a></li>
  </ul></li>
  <li><a href="#step-4-alternative-model---multiplicative-seasonality" id="toc-step-4-alternative-model---multiplicative-seasonality" class="nav-link" data-scroll-target="#step-4-alternative-model---multiplicative-seasonality">Step 4: Alternative Model - Multiplicative Seasonality</a>
  <ul class="collapse">
  <li><a href="#better-visualization-of-the-predictionsmultiplicative" id="toc-better-visualization-of-the-predictionsmultiplicative" class="nav-link" data-scroll-target="#better-visualization-of-the-predictionsmultiplicative">Better Visualization of the predictions(Multiplicative)</a></li>
  <li><a href="#comparison-additive-vs-multiplicative" id="toc-comparison-additive-vs-multiplicative" class="nav-link" data-scroll-target="#comparison-additive-vs-multiplicative">Comparison: Additive vs Multiplicative</a></li>
  </ul></li>
  <li><a href="#step-5-disaggregation-to-department-level" id="toc-step-5-disaggregation-to-department-level" class="nav-link" data-scroll-target="#step-5-disaggregation-to-department-level">Step 5: Disaggregation to Department Level</a>
  <ul class="collapse">
  <li><a href="#apply-disaggregation" id="toc-apply-disaggregation" class="nav-link" data-scroll-target="#apply-disaggregation">Apply Disaggregation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#method-1-direct-department-level-forecasting" id="toc-method-1-direct-department-level-forecasting" class="nav-link" data-scroll-target="#method-1-direct-department-level-forecasting">Method 1: Direct Department-Level Forecasting</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  <li><a href="#trend-analysis-for-department-1" id="toc-trend-analysis-for-department-1" class="nav-link" data-scroll-target="#trend-analysis-for-department-1">Trend Analysis for Department 1</a></li>
  <li><a href="#holt-winters-forecasting-additive-multiplicative" id="toc-holt-winters-forecasting-additive-multiplicative" class="nav-link" data-scroll-target="#holt-winters-forecasting-additive-multiplicative">Holt-Winters Forecasting (Additive &amp; Multiplicative)</a></li>
  </ul></li>
  <li><a href="#final-comparison-method-1-vs-method-2" id="toc-final-comparison-method-1-vs-method-2" class="nav-link" data-scroll-target="#final-comparison-method-1-vs-method-2">Final Comparison: Method 1 vs Method 2</a>
  <ul class="collapse">
  <li><a href="#performance-metrics" id="toc-performance-metrics" class="nav-link" data-scroll-target="#performance-metrics">Performance Metrics</a></li>
  <li><a href="#visual-comparison" id="toc-visual-comparison" class="nav-link" data-scroll-target="#visual-comparison">Visual Comparison</a></li>
  <li><a href="#forecast-errors-analysis" id="toc-forecast-errors-analysis" class="nav-link" data-scroll-target="#forecast-errors-analysis">Forecast Errors Analysis</a></li>
  <li><a href="#performance-metrics-bar-chart" id="toc-performance-metrics-bar-chart" class="nav-link" data-scroll-target="#performance-metrics-bar-chart">Performance Metrics Bar Chart</a></li>
  </ul></li>
  <li><a href="#understanding-the-evaluation-metrics" id="toc-understanding-the-evaluation-metrics" class="nav-link" data-scroll-target="#understanding-the-evaluation-metrics">Understanding the Evaluation Metrics</a>
  <ul class="collapse">
  <li><a href="#why-tse-rmse-and-mae" id="toc-why-tse-rmse-and-mae" class="nav-link" data-scroll-target="#why-tse-rmse-and-mae">Why TSE, RMSE, and MAE?</a>
  <ul class="collapse">
  <li><a href="#total-squared-error-tse" id="toc-total-squared-error-tse" class="nav-link" data-scroll-target="#total-squared-error-tse">1. Total Squared Error (TSE)</a></li>
  <li><a href="#root-mean-squared-error-rmse" id="toc-root-mean-squared-error-rmse" class="nav-link" data-scroll-target="#root-mean-squared-error-rmse">2. Root Mean Squared Error (RMSE)</a></li>
  <li><a href="#mean-absolute-error-mae" id="toc-mean-absolute-error-mae" class="nav-link" data-scroll-target="#mean-absolute-error-mae">3. Mean Absolute Error (MAE)</a></li>
  </ul></li>
  <li><a href="#why-not-mape" id="toc-why-not-mape" class="nav-link" data-scroll-target="#why-not-mape">Why Not MAPE?</a></li>
  <li><a href="#interpreting-the-relationship" id="toc-interpreting-the-relationship" class="nav-link" data-scroll-target="#interpreting-the-relationship">Interpreting the Relationship</a></li>
  <li><a href="#comparison-additive-vs-multiplicative-seasonality-theory" id="toc-comparison-additive-vs-multiplicative-seasonality-theory" class="nav-link" data-scroll-target="#comparison-additive-vs-multiplicative-seasonality-theory">Comparison Additive vs Multiplicative Seasonality (Theory)</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings</a>
  <ul class="collapse">
  <li><a href="#why-did-method-2-win" id="toc-why-did-method-2-win" class="nav-link" data-scroll-target="#why-did-method-2-win">Why Did Method 2 Win?</a></li>
  <li><a href="#when-would-method-1-be-better" id="toc-when-would-method-1-be-better" class="nav-link" data-scroll-target="#when-would-method-1-be-better">When Would Method 1 Be Better?</a></li>
  </ul></li>
  <li><a href="#generalizability" id="toc-generalizability" class="nav-link" data-scroll-target="#generalizability">Generalizability</a></li>
  <li><a href="#limitations-and-future-work" id="toc-limitations-and-future-work" class="nav-link" data-scroll-target="#limitations-and-future-work">Limitations and Future Work</a>
  <ul class="collapse">
  <li><a href="#recommended-extensions" id="toc-recommended-extensions" class="nav-link" data-scroll-target="#recommended-extensions">Recommended Extensions</a></li>
  </ul></li>
  <li><a href="#practical-implications" id="toc-practical-implications" class="nav-link" data-scroll-target="#practical-implications">Practical Implications</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a>
  <ul class="collapse">
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source">Data Source</a></li>
  <li><a href="#methodology-references" id="toc-methodology-references" class="nav-link" data-scroll-target="#methodology-references">Methodology References</a></li>
  <li><a href="#statistical-tests" id="toc-statistical-tests" class="nav-link" data-scroll-target="#statistical-tests">Statistical Tests</a></li>
  </ul></li>
  <li><a href="#appendix-code-repository" id="toc-appendix-code-repository" class="nav-link" data-scroll-target="#appendix-code-repository">Appendix: Code Repository</a>
  <ul class="collapse">
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session Information</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Part1.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Time Series Forecasting: Walmart Sales Analysis Part 1</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Comparing Aggregate vs.&nbsp;Direct Department-Level Forecasting</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Costin-Andrei Taulescu &amp; Panagiotis Valsamis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 25, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>This is the part 1 of the project and explores time series forecasting using Walmart’s historical sales data. We compare two forecasting approaches:</p>
<ul>
<li><strong>Method 1</strong>: Direct forecasting at the department level</li>
<li><strong>Method 2</strong>: Forecasting at an aggregated store level, then disaggregating to departments</li>
</ul>
<p>The analysis focuses on Store 1, Department 1, using Holt-Winters seasonal exponential smoothing models.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Finding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Method 2 (Aggregate-then-Disaggregate) outperformed Method 1 (Direct Forecasting) with an RMSE improvement of 15.22 (3.96%), demonstrating that aggregation can reduce noise and improve forecast accuracy for stable departments.</p>
</div>
</div>
<hr>
</section>
<section id="reproducibility-setup" class="level1">
<h1>Reproducibility Setup</h1>
<section id="environment-setup" class="level2">
<h2 class="anchored" data-anchor-id="environment-setup">Environment Setup</h2>
<p>We recommend creating a virtual environment to ensure reproducible results.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Windows</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">macOS/Linux</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv ts_workshop_env</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ts_workshop_env\Scripts\activate</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> venv ts_workshop_env</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ts_workshop_env/bin/activate</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="required-libraries" class="level2">
<h2 class="anchored" data-anchor-id="required-libraries">Required Libraries</h2>
<div id="5f727c8b" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta    </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller, kpss</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymannkendall <span class="im">as</span> mk</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings for cleaner output</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plotting style</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn-v0_8-darkgrid'</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"husl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="data-overview" class="level1">
<h1>Data Overview</h1>
<section id="loading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-dataset">Loading the Dataset</h2>
<div id="7c626626" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load training data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"../data/train.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First few rows:"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Statistical summary:"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe())</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data types and null counts:"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.info())</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Missing values:"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset shape: (421570, 5)

First few rows:
   Store  Dept        Date  Weekly_Sales  IsHoliday
0      1     1  2010-02-05      24924.50      False
1      1     1  2010-02-12      46039.49       True
2      1     1  2010-02-19      41595.55      False
3      1     1  2010-02-26      19403.54      False
4      1     1  2010-03-05      21827.90      False

Statistical summary:
               Store           Dept   Weekly_Sales
count  421570.000000  421570.000000  421570.000000
mean       22.200546      44.260317   15981.258123
std        12.785297      30.492054   22711.183519
min         1.000000       1.000000   -4988.940000
25%        11.000000      18.000000    2079.650000
50%        22.000000      37.000000    7612.030000
75%        33.000000      74.000000   20205.852500
max        45.000000      99.000000  693099.360000

Data types and null counts:
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 421570 entries, 0 to 421569
Data columns (total 5 columns):
 #   Column        Non-Null Count   Dtype  
---  ------        --------------   -----  
 0   Store         421570 non-null  int64  
 1   Dept          421570 non-null  int64  
 2   Date          421570 non-null  object 
 3   Weekly_Sales  421570 non-null  float64
 4   IsHoliday     421570 non-null  bool   
dtypes: bool(1), float64(1), int64(2), object(1)
memory usage: 13.3+ MB
None

Missing values:
Store           0
Dept            0
Date            0
Weekly_Sales    0
IsHoliday       0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="data-quality-handling-negative-sales" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-handling-negative-sales">Data Quality: Handling Negative Sales</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data Issue Detected
</div>
</div>
<div class="callout-body-container callout-body">
<p>The dataset contains negative values in <code>Weekly_Sales</code>, which are not meaningful in this context. We will set these to zero.</p>
</div>
</div>
<div id="312bef0e" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_negative_values_zero(df, column_name):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Set negative values in a column to zero."""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    df.loc[df[column_name] <span class="op">&lt;</span> <span class="dv">0</span>, column_name] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> negative_values(df, column_name):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Filter rows with negative values in a column."""</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[column_name] <span class="op">&lt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="focus-store-1-analysis" class="level1">
<h1>Focus: Store 1 Analysis</h1>
<p>For this analysis, we focus exclusively on Store 1 to compare forecasting methods.</p>
<div id="61387be9" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Store 1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_store_1 <span class="op">=</span> df[df[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df_store_1 <span class="op">=</span> make_negative_values_zero(df_store_1, <span class="st">"Weekly_Sales"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Store 1 data shape: </span><span class="sc">{</span>df_store_1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Departments in Store 1:"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_store_1[<span class="st">"Dept"</span>].value_counts().sort_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Store 1 data shape: (10244, 5)

Departments in Store 1:
Dept
1     143
2     143
3     143
4     143
5     143
     ... 
95    143
96    122
97    143
98    143
99     37
Name: count, Length: 77, dtype: int64</code></pre>
</div>
</div>
<section id="train-test-split" class="level2">
<h2 class="anchored" data-anchor-id="train-test-split">Train-Test Split</h2>
<div id="bcebafe5" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Date to datetime</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_store_1[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df_store_1[<span class="st">'Date'</span>])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define test period: last 4 weeks</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>max_date <span class="op">=</span> df_store_1[<span class="st">'Date'</span>].<span class="bu">max</span>()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>test_start_date <span class="op">=</span> max_date <span class="op">-</span> pd.Timedelta(weeks<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training data: Up to </span><span class="sc">{</span>test_start_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test data: </span><span class="sc">{</span>test_start_date<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>max_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>df_store_1_train <span class="op">=</span> df_store_1[df_store_1[<span class="st">'Date'</span>] <span class="op">&lt;</span> test_start_date].copy()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>df_store_1_test <span class="op">=</span> df_store_1[df_store_1[<span class="st">'Date'</span>] <span class="op">&gt;=</span> test_start_date].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training data: Up to 2012-10-05 00:00:00
Test data: 2012-10-05 00:00:00 to 2012-10-26 00:00:00</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="method-2-aggregate-then-disaggregate" class="level1">
<h1>Method 2: Aggregate-then-Disaggregate</h1>
<section id="step-1-aggregate-store-level-sales" class="level2">
<h2 class="anchored" data-anchor-id="step-1-aggregate-store-level-sales">Step 1: Aggregate Store-Level Sales</h2>
<div id="cell-fig-aggregated-sales" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate all departments by date</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>store_1_aggregated_train <span class="op">=</span> df_store_1_train.groupby(<span class="st">'Date'</span>).agg({</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Weekly_Sales'</span>: <span class="st">'sum'</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>store_1_aggregated_test <span class="op">=</span> df_store_1_test.groupby(<span class="st">'Date'</span>).agg({</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Weekly_Sales'</span>: <span class="st">'sum'</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>store_1_aggregated <span class="op">=</span> store_1_aggregated_train.sort_values(<span class="st">'Date'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize aggregated sales</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated[<span class="st">'Date'</span>], </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Aggregated Weekly Sales Over Time (Training Set)'</span>, </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-aggregated-sales" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aggregated-sales-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-aggregated-sales-output-1.png" width="1526" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-aggregated-sales-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Store 1 Aggregated Weekly Sales (Training Period)
</figcaption>
</figure>
</div>
</div>
</div>
<section id="initial-observations" class="level3">
<h3 class="anchored" data-anchor-id="initial-observations">Initial Observations</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Seasonal Patterns Observed
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Clear peaks at year-end (holiday shopping)</li>
<li>Consistent troughs at year start (post-holiday slowdown)</li>
<li>Regular seasonal cycle without strong trend</li>
</ul>
</div>
</div>
</section>
</section>
<section id="step-2-statistical-tests-for-trend" class="level2">
<h2 class="anchored" data-anchor-id="step-2-statistical-tests-for-trend">Step 2: Statistical Tests for Trend</h2>
<p>Before modeling, we test whether the series exhibits a significant trend.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notes for Statistical Tests
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Why we used stationary test (ADF,KPSS) for checking for trend? Stationary series has constant mean, an increasing or decreasing trend violates this definition.</p></li>
<li><p>MANN-KENDALL test and COX-STUART test are mainly used for identifying trend.</p></li>
</ul>
</div>
</div>
<div id="26fa1368" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> run_trend_analysis <span class="im">import</span> analyze_series</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_store_for_tests <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> analyze_series(df_store_for_tests, series_name<span class="op">=</span><span class="st">"Store 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
######################################################################
COMPREHENSIVE TREND ANALYSIS FOR: Store 1
######################################################################

Data points: 139
Mean: 1555116.40
Std Dev: 157221.96
Min: 1316899.31
Max: 2387950.20

======================================================================
1. MANN-KENDALL TEST (Non-parametric)
======================================================================
Trend: increasing
Test Statistic (S): 1743.0
p-value: 0.001514
Tau (correlation): 0.181733
z-score: 3.172081

 RESULT: Significant trend detected (p &lt; 0.05)
  Direction: increasing

======================================================================
2. AUGMENTED DICKEY-FULLER (ADF) TEST
======================================================================
ADF Statistic: -5.037909
p-value: 0.000019
Lags used: 4
Number of observations: 134

Critical Values:
  1%: -3.480
  5%: -2.883
  10%: -2.578

 RESULT: Series is stationary (p &lt; 0.05)
   No unit root → Suggests NO trend

======================================================================
3. KPSS TEST (Kwiatkowski-Phillips-Schmidt-Shin)
======================================================================
KPSS Test (with trend):
KPSS Statistic: 0.058672
p-value: 0.100000
Lags used: 3

Critical Values:
  10%: 0.119
  5%: 0.146
  2.5%: 0.176
  1%: 0.216

 RESULT: Series is trend stationary (p &gt;= 0.05)
   Null hypothesis not rejected → NO significant trend

======================================================================
4. LINEAR REGRESSION TEST
======================================================================
Slope: 872.876123
Intercept: 1494887.95
R-squared: 0.049625
p-value: 0.008392
Standard Error: 326.352820

95% Confidence Interval for slope: [227.535870, 1518.216375]

 RESULT: Significant positive linear trend (p &lt; 0.05)

======================================================================
5. COX-STUART TEST (Non-parametric)
======================================================================
Number of pairs: 69
Plus signs (+): 41 (second half &gt; first half)
Minus signs (-): 28 (second half &lt; first half)
Ties: 0
p-value: 0.148032

 RESULT: No significant trend (p &gt;= 0.05)

======================================================================
6. SPEARMAN'S RANK CORRELATION TEST (Bonus)
======================================================================
Spearman's rho: 0.291193
p-value: 0.000506

 RESULT: Significant positive monotonic trend (p &lt; 0.05)

======================================================================
SUMMARY OF RESULTS
======================================================================

Trend Detection Tests:
  Mann-Kendall: increasing (p=0.0015)
  Linear Regression: Trend (p=0.0084)
  Cox-Stuart: No Trend (p=0.1480)
  Spearman: Trend (p=0.0005)

Stationarity Tests:
  ADF: Stationary (p=0.0000)
  KPSS: Trend Stationary (p=0.1000)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Trend Analysis Conclusion
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mixed results from statistical tests suggest weak or no persistent trend. Visual inspection confirms regular seasonality without long-term increase/decrease. Therefore, we use <strong>Holt-Winters Seasonal (No Trend)</strong> model.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why Holt-Winters
</div>
</div>
<div class="callout-body-container callout-body">
<p>Holt Winters uses exponential smoothing to assign more weight to recent observations while reducing the influence of older data. This method ensures that the model is responsive to recent changes in seanlity or trends(here we assumed no trend), making it ideal for scenarios where the latest data is the most relevant for forecasting.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Holt–Winters (Additive) Formulas
</div>
</div>
<div class="callout-body-container callout-body">
<section id="updating-equations" class="level3">
<h3 class="anchored" data-anchor-id="updating-equations">Updating equations</h3>
<p><span class="math display">\[
L_t = \alpha (y_t - S_{t-m}) + (1-\alpha)(L_{t-1}+T_{t-1})
\]</span></p>
<p><span class="math display">\[
T_t = \beta (L_t - L_{t-1}) + (1-\beta)T_{t-1}
\]</span></p>
<p><span class="math display">\[
S_t = \gamma (y_t - L_t) + (1-\gamma) S_{t-m}
\]</span></p>
</section>
<section id="forecast" class="level3">
<h3 class="anchored" data-anchor-id="forecast">Forecast</h3>
<p><span class="math display">\[
\hat y_{t+h} = L_t + hT_t + S_{t+h-mk},
\qquad
k=\left\lfloor \frac{h-1}{m} \right\rfloor
\]</span></p>
</section>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Benefits:</strong></p>
<ul>
<li><p>Balances recent and historical data. As we said it uses exponential smoothing to prioritize recent observations while still incorporating historical data.</p></li>
<li><p>Lower computational power. Compared to other machine learning and deep learning models requires by far less computational power and resources.</p></li>
</ul>
<p><strong>Drawbacks:</strong></p>
<ul>
<li><p>Sensitivity to parameter tuning. It requires grid search of the parameters in order not to provide inaccurate parameters.</p></li>
<li><p>It is not performing very well in non-linear patterns. While it performs well on datasets with clear trends and seasonal cycles it is not suited for datasets where exhibits non-linear growth or decline.</p></li>
</ul>
</div>
</div>
</section>
<section id="step-3-holt-winters-forecasting-additive-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="step-3-holt-winters-forecasting-additive-seasonality">Step 3: Holt-Winters Forecasting (Additive Seasonality)</h2>
<div id="bcd9689f" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> TSE(y_true, y_pred):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Total Squared Error"""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_seasonal_no_trend(y, alpha, gamma, m):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Holt-Winters Seasonal Method without Trend (Additive)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - y: time series data</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - alpha: level smoothing parameter</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - gamma: seasonal smoothing parameter</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">    - m: season length (52 for weekly data with yearly seasonality)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialization</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    level <span class="op">=</span> np.mean(y[:m])</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    seasonals <span class="op">=</span> <span class="bu">list</span>(y[:m] <span class="op">-</span> level)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    fitted <span class="op">=</span> [np.nan] <span class="op">*</span> n</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(m, n):</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        fitted[t] <span class="op">=</span> level <span class="op">+</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> alpha <span class="op">*</span> (y[t] <span class="op">-</span> seasonals[t <span class="op">-</span> m]) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">*</span> level</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        new_seasonal <span class="op">=</span> gamma <span class="op">*</span> (y[t] <span class="op">-</span> new_level) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> gamma) <span class="op">*</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> new_level</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        seasonals.append(new_seasonal)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(fitted), level, seasonals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="grid-search-for-optimal-parameters" class="level3">
<h3 class="anchored" data-anchor-id="grid-search-for-optimal-parameters">Grid Search for Optimal Parameters</h3>
<div id="ded3f9a0" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span>  <span class="co"># Weekly data, yearly seasonality</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>gammas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Running grid search for optimal parameters..."</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend(y_train, alpha, gamma, m)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train[valid_idx], fitted[valid_idx])</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best TSE (training): </span><span class="sc">{</span>best_tse<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running grid search for optimal parameters...
Best parameters: alpha=0.15, gamma=0.75
Best TSE (training): 388685740510.08</code></pre>
</div>
</div>
</section>
<section id="generate-forecasts" class="level3">
<h3 class="anchored" data-anchor-id="generate-forecasts">Generate Forecasts</h3>
<div id="cell-fig-hw-additive" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(store_1_aggregated_test)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>alpha_best, gamma_best <span class="op">=</span> best_params</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> []</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    forecast.append(level <span class="op">+</span> seasonals[seasonal_index])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> np.array(forecast)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> store_1_aggregated_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>tse_test <span class="op">=</span> TSE(y_test, forecast)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>rmse_test <span class="op">=</span> np.sqrt(np.mean((y_test <span class="op">-</span> forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>mae_test <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test <span class="op">-</span> forecast))</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test TSE: </span><span class="sc">{</span>tse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test MAE: </span><span class="sc">{</span>mae_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_train[<span class="st">'Date'</span>], </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_train[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>], </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data'</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>         forecast,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Holt-Winters Forecast (Additive)'</span>,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)   </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)    </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Holt-Winters Seasonal Forecast vs Actuals (Additive)'</span>, </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Store results</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>additive_results <span class="op">=</span> {</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test,</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test,</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test,</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast.copy()</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test TSE: 775926584.92
Test RMSE: 13927.73
Test MAE: 11983.60</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-hw-additive" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hw-additive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-hw-additive-output-2.png" width="1526" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hw-additive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Holt-Winters Additive Forecast vs Actuals
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="better-visualization-of-the-predictionadditive" class="level3">
<h3 class="anchored" data-anchor-id="better-visualization-of-the-predictionadditive">Better Visualization of the prediction(Additive)</h3>
<div id="fc6f4dee" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    y_test,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    forecast,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Holt–Winters Forecast(Additive Seasonal, No Trend)'</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Holt–Winters Forecast vs Actuals (Test Set) Additive Seasonal, No Trend'</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Part1_files/figure-html/cell-12-output-1.png" width="1142" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="step-4-alternative-model---multiplicative-seasonality" class="level2">
<h2 class="anchored" data-anchor-id="step-4-alternative-model---multiplicative-seasonality">Step 4: Alternative Model - Multiplicative Seasonality</h2>
<div id="b8aa79e8" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_seasonal_no_trend_multiplicative(y, alpha, gamma, m):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Holt-Winters Seasonal Method without Trend - Multiplicative Seasonality</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    y: time series data</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">    alpha: level smoothing parameter</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    gamma: seasonal smoothing parameter</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">    m: season length</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialization</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    level <span class="op">=</span> np.mean(y[:m])</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    seasonals <span class="op">=</span> <span class="bu">list</span>(y[:m] <span class="op">/</span> level)  <span class="co"># Multiplicative: divide instead of subtract</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    fitted <span class="op">=</span> [np.nan] <span class="op">*</span> n</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(m, n):</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        fitted[t] <span class="op">=</span> level <span class="op">*</span> seasonals[t <span class="op">-</span> m]  <span class="co"># Multiplicative: multiply instead of add</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update level (deseasonalize by dividing)</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> alpha <span class="op">*</span> (y[t] <span class="op">/</span> seasonals[t <span class="op">-</span> m]) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">*</span> level</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update seasonal component (ratio)</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        new_seasonal <span class="op">=</span> gamma <span class="op">*</span> (y[t] <span class="op">/</span> new_level) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> gamma) <span class="op">*</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> new_level</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        seasonals.append(new_seasonal)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(fitted), level, seasonals</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid search for optimal parameters</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>gammas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend_multiplicative(</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>            y_train, alpha, gamma, m</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train[valid_idx], fitted[valid_idx])</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best TSE (training): </span><span class="sc">{</span>best_tse<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(store_1_aggregated_test)</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>alpha_best, gamma_best <span class="op">=</span> best_params</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> []</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    forecast.append(level <span class="op">*</span> seasonals[seasonal_index])  <span class="co"># Multiplicative</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> np.array(forecast)</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> store_1_aggregated_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>tse_test <span class="op">=</span> TSE(y_test, forecast)</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>rmse_test <span class="op">=</span> np.sqrt(np.mean((y_test <span class="op">-</span> forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>mae_test <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test <span class="op">-</span> forecast))</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test TSE: </span><span class="sc">{</span>tse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test MAE: </span><span class="sc">{</span>mae_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_train[<span class="st">'Date'</span>], </span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_train[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>], </span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data'</span>,</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>         forecast,</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Holt-Winters Forecast (Multiplicative)'</span>,</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)   </span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)    </span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Holt-Winters Seasonal Forecast (Multiplicative) vs Actuals'</span>, </span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>multiplicative_results <span class="op">=</span> {</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test,</span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test,</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test,</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast.copy()  <span class="co"># Store the forecast</span></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Best parameters: alpha=0.15, gamma=0.70
Best TSE (training): 405240934553.55

Test TSE: 842717466.42
Test RMSE: 14514.80
Test MAE: 11739.95</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Part1_files/figure-html/cell-13-output-2.png" width="1526" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="better-visualization-of-the-predictionsmultiplicative" class="level3">
<h3 class="anchored" data-anchor-id="better-visualization-of-the-predictionsmultiplicative">Better Visualization of the predictions(Multiplicative)</h3>
<div id="53522c4d" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    y_test,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    forecast,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Holt–Winters Forecast'</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Holt–Winters Forecast vs Actuals (Test Set) - Multiplicative Seasonal, No Trend'</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Part1_files/figure-html/cell-14-output-1.png" width="1142" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-additive-vs-multiplicative" class="level3">
<h3 class="anchored" data-anchor-id="comparison-additive-vs-multiplicative">Comparison: Additive vs Multiplicative</h3>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Metric'</span>: [<span class="st">'Alpha'</span>, <span class="st">'Gamma'</span>, <span class="st">'Train TSE'</span>, <span class="st">'Test TSE'</span>, <span class="st">'Test RMSE'</span>, <span class="st">'Test MAE'</span>],</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Additive'</span>: [</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'alpha'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'gamma'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'tse_train'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Multiplicative'</span>: [</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'alpha'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'gamma'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'tse_train'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-additive-vs-mult" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="14">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-additive-vs-mult-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Performance Comparison: Additive vs Multiplicative Seasonality
</figcaption>
<div aria-describedby="tbl-additive-vs-mult-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>   Metric        Additive  Multiplicative
    Alpha            0.15            0.15
    Gamma            0.75            0.70
Train TSE 388685740510.08 405240934553.55
 Test TSE    775926584.92    842717466.42
Test RMSE        13927.73        14514.80
 Test MAE        11983.60        11739.95</code></pre>
</div>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model Selection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Both models produce nearly identical forecasts. This similarity occurs because seasonal fluctuations remain relatively constant in absolute terms. We proceed with the <strong>additive model</strong> for disaggregation.</p>
</div>
</div>
</section>
</section>
<section id="step-5-disaggregation-to-department-level" class="level2">
<h2 class="anchored" data-anchor-id="step-5-disaggregation-to-department-level">Step 5: Disaggregation to Department Level</h2>
<div id="cell-fig-dept-proportion" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Department 1 data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train <span class="op">=</span> df_store_1_train[</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    (df_store_1_train[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_train[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train <span class="op">=</span> store_1_dept_1_train.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to calculate proportions</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>all_merged <span class="op">=</span> pd.merge(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    store_1_dept_1_train[[<span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]],</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_train[[<span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]],</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">'_dept'</span>, <span class="st">'_store'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>all_merged[<span class="st">'proportion'</span>] <span class="op">=</span> all_merged[<span class="st">'Weekly_Sales_dept'</span>] <span class="op">/</span> all_merged[<span class="st">'Weekly_Sales_store'</span>]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>avg_proportion <span class="op">=</span> all_merged[<span class="st">'proportion'</span>].mean()</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>std_proportion <span class="op">=</span> all_merged[<span class="st">'proportion'</span>].std()</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1's proportion of Store 1 sales:"</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>avg_proportion<span class="sc">:.4f}</span><span class="ss"> (</span><span class="sc">{</span>avg_proportion<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Std:  </span><span class="sc">{</span>std_proportion<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize proportion stability</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>plt.plot(all_merged[<span class="st">'Date'</span>], all_merged[<span class="st">'proportion'</span>], </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f'Mean: </span><span class="sc">{</span>avg_proportion<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion <span class="op">+</span> std_proportion, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'±1 Std Dev'</span>)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion <span class="op">-</span> std_proportion, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Department 1 Proportion'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Department 1 as Proportion of Store 1 Total Sales (Training Period)'</span>, </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Department 1's proportion of Store 1 sales:
  Mean: 0.0143 (1.43%)
  Std:  0.0054</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-dept-proportion" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dept-proportion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-dept-proportion-output-2.png" width="1334" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dept-proportion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Department 1 as Proportion of Store 1 Total Sales
</figcaption>
</figure>
</div>
</div>
</div>
<section id="apply-disaggregation" class="level3">
<h3 class="anchored" data-anchor-id="apply-disaggregation">Apply Disaggregation</h3>
<div id="cell-fig-method2-forecast" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disaggregate store-level forecast</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>dept_1_forecast <span class="op">=</span> additive_results[<span class="st">'forecast'</span>] <span class="op">*</span> avg_proportion</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get actual Department 1 test data</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_test <span class="op">=</span> df_store_1_test[</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    (df_store_1_test[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_test[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_test <span class="op">=</span> store_1_dept_1_test.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>y_test_dept_1 <span class="op">=</span> store_1_dept_1_test[<span class="st">'Weekly_Sales'</span>].values</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>tse_dept_1 <span class="op">=</span> TSE(y_test_dept_1, dept_1_forecast)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>rmse_dept_1 <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1 <span class="op">-</span> dept_1_forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>mae_dept_1 <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1 <span class="op">-</span> dept_1_forecast))</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 Disaggregated Forecast Performance (Method 2):"</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test TSE:  </span><span class="sc">{</span>tse_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test RMSE: </span><span class="sc">{</span>rmse_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test MAE:  </span><span class="sc">{</span>mae_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train_plot <span class="op">=</span> df_store_1_train[</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    (df_store_1_train[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_train[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train_plot <span class="op">=</span> store_1_dept_1_train_plot.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_train_plot[<span class="st">'Date'</span>],</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>         store_1_dept_1_train_plot[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data (Dept 1)'</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>         y_test_dept_1,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data (Dept 1)'</span>,</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>         dept_1_forecast,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Disaggregated Forecast (Method 2)'</span>,</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Department 1: Disaggregated Forecast vs Actuals (Method 2)'</span>, </span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Store Method 2 results</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>method2_results <span class="op">=</span> {</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_dept_1,</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_dept_1,</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_dept_1,</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: dept_1_forecast.copy()</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Department 1 Disaggregated Forecast Performance (Method 2):
  Test TSE:  49541178.78
  Test RMSE: 3519.27
  Test MAE:  2827.42</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-method2-forecast" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-method2-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-method2-forecast-output-2.png" width="1526" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-method2-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Method 2: Disaggregated Forecast for Department 1
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notes
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the above graph, we can see that the forecasted sales for department 1 using the aggregate-then-disaggregate method does not capture the actual sales pattern very well. The forecasted values are significantly lower than the actual sales during the 3/4 of the test period, indicating that this method may not be effective for department-level forecasting in this case.</p>
<p>We expect that Method 1 (direct forecasting at the department level) will outperform Method 2 (aggregate-then-disaggregate) for department-level forecasts. This is because Method 1 can capture department-specific trends and seasonal patterns that are lost when aggregating sales across all departments in Method 2. As a result, we anticipate lower forecast errors (e.g., RMSE) for Method 1 compared to Method 2 when evaluating at the department level.</p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="method-1-direct-department-level-forecasting" class="level1">
<h1>Method 1: Direct Department-Level Forecasting</h1>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<div id="600cd5e3" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Store 1, Department 1</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1 <span class="op">=</span> df[(df[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)].copy()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1 <span class="op">=</span> make_negative_values_zero(df_store_1_dept_1, <span class="st">"Weekly_Sales"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df_store_1_dept_1[<span class="st">'Date'</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split train/test</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_train <span class="op">=</span> df_store_1_dept_1[df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">&lt;</span> test_start_date].copy()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_test <span class="op">=</span> df_store_1_dept_1[df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">&gt;=</span> test_start_date].copy()</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_train <span class="op">=</span> df_store_1_dept_1_train.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_test <span class="op">=</span> df_store_1_dept_1_test.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 training data shape: </span><span class="sc">{</span>df_store_1_dept_1_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 test data shape: </span><span class="sc">{</span>df_store_1_dept_1_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Department 1 training data shape: (139, 5)
Department 1 test data shape: (4, 5)</code></pre>
</div>
</div>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<div id="cell-fig-dept1-raw" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_train[<span class="st">'Date'</span>],</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         df_store_1_dept_1_train[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data (Dept 1)'</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>         df_store_1_dept_1_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data (Dept 1)'</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Department 1: Actual Weekly Sales Over Time'</span>, </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-dept1-raw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dept1-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-dept1-raw-output-1.png" width="1526" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dept1-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Store 1, Department 1: Raw Weekly Sales Data
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="trend-analysis-for-department-1" class="level2">
<h2 class="anchored" data-anchor-id="trend-analysis-for-department-1">Trend Analysis for Department 1</h2>
<div id="41c544b9" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>analyze_series(df_store_1_dept_1_train[<span class="st">"Weekly_Sales"</span>], </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>               series_name<span class="op">=</span><span class="st">"Store 1, Department 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
######################################################################
COMPREHENSIVE TREND ANALYSIS FOR: Store 1, Department 1
######################################################################

Data points: 139
Mean: 22468.78
Std Dev: 9950.26
Min: 14537.37
Max: 57592.12

======================================================================
1. MANN-KENDALL TEST (Non-parametric)
======================================================================
Trend: no trend
Test Statistic (S): -423.0
p-value: 0.442227
Tau (correlation): -0.044104
z-score: -0.768437

 RESULT: No significant trend (p &gt;= 0.05)

======================================================================
2. AUGMENTED DICKEY-FULLER (ADF) TEST
======================================================================
ADF Statistic: -2.405435
p-value: 0.140208
Lags used: 6
Number of observations: 132

Critical Values:
  1%: -3.481
  5%: -2.884
  10%: -2.579

 RESULT: Series is non-stationary (p &gt;= 0.05)
   Unit root present → May have trend

======================================================================
3. KPSS TEST (Kwiatkowski-Phillips-Schmidt-Shin)
======================================================================
KPSS Test (with trend):
KPSS Statistic: 0.081207
p-value: 0.100000
Lags used: 4

Critical Values:
  10%: 0.119
  5%: 0.146
  2.5%: 0.176
  1%: 0.216

 RESULT: Series is trend stationary (p &gt;= 0.05)
   Null hypothesis not rejected → NO significant trend

======================================================================
4. LINEAR REGRESSION TEST
======================================================================
Slope: -22.763939
Intercept: 24039.49
R-squared: 0.008427
p-value: 0.282481
Standard Error: 21.097145

95% Confidence Interval for slope: [-64.482092, 18.954213]

 RESULT: No significant linear trend (p &gt;= 0.05)

======================================================================
5. COX-STUART TEST (Non-parametric)
======================================================================
Number of pairs: 69
Plus signs (+): 31 (second half &gt; first half)
Minus signs (-): 38 (second half &lt; first half)
Ties: 0
p-value: 0.470369

 RESULT: No significant trend (p &gt;= 0.05)

======================================================================
6. SPEARMAN'S RANK CORRELATION TEST (Bonus)
======================================================================
Spearman's rho: -0.072251
p-value: 0.397978

 RESULT: No significant monotonic trend (p &gt;= 0.05)

======================================================================
SUMMARY OF RESULTS
======================================================================

Trend Detection Tests:
  Mann-Kendall: no trend (p=0.4422)
  Linear Regression: No Trend (p=0.2825)
  Cox-Stuart: No Trend (p=0.4704)
  Spearman: No Trend (p=0.3980)

Stationarity Tests:
  ADF: Non-Stationary (p=0.1402)
  KPSS: Trend Stationary (p=0.1000)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>{'mann_kendall': Mann_Kendall_Test(trend='no trend', h=np.False_, p=np.float64(0.4422273171060662), z=np.float64(-0.7684374858531829), Tau=np.float64(-0.04410384735689709), s=np.float64(-423.0), var_s=301583.6666666667, slope=np.float64(-5.937755102040831), intercept=np.float64(18870.88510204082)),
 'adf': (np.float64(-2.405434611809666),
  np.float64(0.14020840124603),
  6,
  132,
  {'1%': np.float64(-3.4808880719210005),
   '5%': np.float64(-2.8836966192225284),
   '10%': np.float64(-2.5785857598714417)},
  np.float64(2559.54932867161)),
 'kpss': (np.float64(0.08120673481546524),
  np.float64(0.1),
  4,
  {'10%': 0.119, '5%': 0.146, '2.5%': 0.176, '1%': 0.216}),
 'linear_regression': {'slope': np.float64(-22.76393931811073),
  'intercept': np.float64(24039.49325179856),
  'p_value': np.float64(0.2824812253064499),
  'r_squared': np.float64(0.008426588409779619),
  'std_err': np.float64(21.097144684801)},
 'cox_stuart': {'plus': np.int64(31),
  'minus': np.int64(38),
  'p_value': np.float64(0.47036853185814453)},
 'spearman': {'rho': np.float64(-0.07225077081192188),
  'p_value': np.float64(0.39797839318678596)}}</code></pre>
</div>
</div>
</section>
<section id="holt-winters-forecasting-additive-multiplicative" class="level2">
<h2 class="anchored" data-anchor-id="holt-winters-forecasting-additive-multiplicative">Holt-Winters Forecasting (Additive &amp; Multiplicative)</h2>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>y_train_dept_1 <span class="op">=</span> df_store_1_dept_1_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ADDITIVE MODEL</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Training Method 1 - Additive Model..."</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>            y_train_dept_1, alpha, gamma, m</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train_dept_1[valid_idx], fitted[valid_idx])</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Additive - Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(df_store_1_dept_1_test)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>forecast_method1_additive <span class="op">=</span> []</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    forecast_method1_additive.append(level <span class="op">+</span> seasonals[seasonal_index])</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>forecast_method1_additive <span class="op">=</span> np.array(forecast_method1_additive)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>y_test_dept_1_actual <span class="op">=</span> df_store_1_dept_1_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>tse_test_add <span class="op">=</span> TSE(y_test_dept_1_actual, forecast_method1_additive)</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>rmse_test_add <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1_actual <span class="op">-</span> forecast_method1_additive) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>mae_test_add <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1_actual <span class="op">-</span> forecast_method1_additive))</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test_add<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>method1_additive_results <span class="op">=</span> {</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test_add,</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test_add,</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test_add,</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast_method1_additive.copy()</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="co"># MULTIPLICATIVE MODEL</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training Method 1 - Multiplicative Model..."</span>)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend_multiplicative(</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>            y_train_dept_1, alpha, gamma, m</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train_dept_1[valid_idx], fitted[valid_idx])</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Multiplicative - Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>forecast_method1_multiplicative <span class="op">=</span> []</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>    forecast_method1_multiplicative.append(level <span class="op">*</span> seasonals[seasonal_index])</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>forecast_method1_multiplicative <span class="op">=</span> np.array(forecast_method1_multiplicative)</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>tse_test_mult <span class="op">=</span> TSE(y_test_dept_1_actual, forecast_method1_multiplicative)</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>rmse_test_mult <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1_actual <span class="op">-</span> forecast_method1_multiplicative) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>mae_test_mult <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1_actual <span class="op">-</span> forecast_method1_multiplicative))</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test_mult<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>method1_multiplicative_results <span class="op">=</span> {</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test_mult,</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test_mult,</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test_mult,</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast_method1_multiplicative.copy()</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Select better model for comparison</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> method1_additive_results[<span class="st">'rmse_test'</span>] <span class="op">&lt;=</span> method1_multiplicative_results[<span class="st">'rmse_test'</span>]:</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>    method1_results <span class="op">=</span> method1_additive_results</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    method1_type <span class="op">=</span> <span class="st">"Additive"</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>    method1_results <span class="op">=</span> method1_multiplicative_results</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>    method1_type <span class="op">=</span> <span class="st">"Multiplicative"</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Selected for comparison: </span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss"> model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-method1-both" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-method1-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>Training Method 1 - Additive Model...
Additive - Best parameters: alpha=0.05, gamma=0.30
Test RMSE: 5238.80

Training Method 1 - Multiplicative Model...
Multiplicative - Best parameters: alpha=0.55, gamma=0.95
Test RMSE: 5175.90

Selected for comparison: Multiplicative model</code></pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-method1-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
<hr>
</section>
</section>
<section id="final-comparison-method-1-vs-method-2" class="level1">
<h1>Final Comparison: Method 1 vs Method 2</h1>
<section id="performance-metrics" class="level2">
<h2 class="anchored" data-anchor-id="performance-metrics">Performance Metrics</h2>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>comparison_final <span class="op">=</span> pd.DataFrame({</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Metric'</span>: [<span class="st">'TSE'</span>, <span class="st">'RMSE'</span>, <span class="st">'MAE'</span>],</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Method 1 (Direct)'</span>: [</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Method 2 (Disaggregate)'</span>: [</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Difference (M2 - M1)'</span>: [</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'tse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'tse_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'rmse_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'mae_test'</span>] <span class="op">-</span> method1_results[<span class="st">'mae_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_final.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine winner</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> method1_results[<span class="st">'rmse_test'</span>] <span class="op">&lt;</span> method2_results[<span class="st">'rmse_test'</span>]:</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    better_method <span class="op">=</span> <span class="st">"METHOD 1 (Direct Forecasting)"</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    rmse_improvement <span class="op">=</span> method2_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'rmse_test'</span>]</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    better_method <span class="op">=</span> <span class="st">"METHOD 2 (Disaggregation)"</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    rmse_improvement <span class="op">=</span> method1_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method2_results[<span class="st">'rmse_test'</span>]</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>improvement_pct <span class="op">=</span> (rmse_improvement <span class="op">/</span> <span class="bu">max</span>(method1_results[<span class="st">'rmse_test'</span>], method2_results[<span class="st">'rmse_test'</span>])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"WINNER: </span><span class="sc">{</span>better_method<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE Improvement: </span><span class="sc">{</span>rmse_improvement<span class="sc">:.2f}</span><span class="ss"> (</span><span class="sc">{</span>improvement_pct<span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-final-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="21">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-final-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Final Performance Comparison: Method 1 vs Method 2
</figcaption>
<div aria-describedby="tbl-final-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>Metric Method 1 (Direct) Method 2 (Disaggregate) Difference (M2 - M1)
   TSE      107159678.11             49541178.78         -57618499.33
  RMSE           5175.90                 3519.27             -1656.62
   MAE           3895.25                 2827.42             -1067.83

============================================================
WINNER: METHOD 2 (Disaggregation)
RMSE Improvement: 1656.62 (32.01%)
============================================================</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="visual-comparison" class="level2">
<h2 class="anchored" data-anchor-id="visual-comparison">Visual Comparison</h2>
<div id="cell-fig-final-comparison" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>], </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>         y_test_dept_1_actual,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>         zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>         method1_results[<span class="st">'forecast'</span>],</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="ss">f'Method 1: Direct Forecasting (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>         alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>         method2_results[<span class="st">'forecast'</span>],</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Method 2: Disaggregation'</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'^'</span>,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>         alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>         linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Dept 1: Method 1 vs Method 2 Forecast Comparison'</span>, </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">11</span>, loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-final-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-final-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-final-comparison-output-1.png" width="1526" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-final-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Final Forecast Comparison: Method 1 vs Method 2
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="forecast-errors-analysis" class="level2">
<h2 class="anchored" data-anchor-id="forecast-errors-analysis">Forecast Errors Analysis</h2>
<div id="cell-fig-errors" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>errors_method1 <span class="op">=</span> y_test_dept_1_actual <span class="op">-</span> method1_results[<span class="st">'forecast'</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>errors_method2 <span class="op">=</span> y_test_dept_1_actual <span class="op">-</span> method2_results[<span class="st">'forecast'</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 1: Forecast Errors</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>             errors_method1,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Method 1 Errors (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>             errors_method2,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">'Method 2 Errors'</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Forecast Error ($)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Forecast Errors: Method 1 vs Method 2'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 2: Absolute Errors</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>abs_errors_method1 <span class="op">=</span> np.<span class="bu">abs</span>(errors_method1)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>abs_errors_method2 <span class="op">=</span> np.<span class="bu">abs</span>(errors_method2)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>             abs_errors_method1,</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Method 1 Absolute Errors'</span>,</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>             abs_errors_method2,</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">'Method 2 Absolute Errors'</span>,</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span>method1_results[<span class="st">'mae_test'</span>], color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="ss">f'Method 1 MAE: </span><span class="sc">{</span>method1_results[<span class="st">"mae_test"</span>]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span>method2_results[<span class="st">'mae_test'</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="ss">f'Method 2 MAE: </span><span class="sc">{</span>method2_results[<span class="st">"mae_test"</span>]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Absolute Error ($)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Absolute Forecast Errors: Method 1 vs Method 2'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-errors" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-errors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-errors-output-1.png" width="1527" height="952" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-errors-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Forecast Errors Over Time
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="performance-metrics-bar-chart" class="level2">
<h2 class="anchored" data-anchor-id="performance-metrics-bar-chart">Performance Metrics Bar Chart</h2>
<div id="cell-fig-metrics-bar" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">'TSE'</span>, <span class="st">'RMSE'</span>, <span class="st">'MAE'</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>method1_values <span class="op">=</span> [method1_results[<span class="st">'tse_test'</span>], method1_results[<span class="st">'rmse_test'</span>], method1_results[<span class="st">'mae_test'</span>]]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>method2_values <span class="op">=</span> [method2_results[<span class="st">'tse_test'</span>], method2_results[<span class="st">'rmse_test'</span>], method2_results[<span class="st">'mae_test'</span>]]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(metrics))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, method1_values, width, label<span class="op">=</span><span class="ss">f'Method 1 (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>, </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, method2_values, width, label<span class="op">=</span><span class="st">'Method 2 (Disaggregation)'</span>, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Metrics'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Value'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Forecast Performance Comparison: Method 1 vs Method 2'</span>, </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(x)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(metrics)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bars <span class="kw">in</span> [bars1, bars2]:</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> bar.get_height()</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>        ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height,</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-metrics-bar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-metrics-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Part1_files/figure-html/fig-metrics-bar-output-1.png" width="950" height="565" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-metrics-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Performance Metrics Comparison
</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="understanding-the-evaluation-metrics" class="level1">
<h1>Understanding the Evaluation Metrics</h1>
<section id="why-tse-rmse-and-mae" class="level2">
<h2 class="anchored" data-anchor-id="why-tse-rmse-and-mae">Why TSE, RMSE, and MAE?</h2>
<p>We use three complementary metrics to comprehensively evaluate forecast quality:</p>
<section id="total-squared-error-tse" class="level3">
<h3 class="anchored" data-anchor-id="total-squared-error-tse">1. Total Squared Error (TSE)</h3>
<p><span class="math display">\[\text{TSE} = \sum_{t=1}^{n} (y_t - \hat{y}_t)^2\]</span></p>
<ul>
<li>Aggregated loss function across all test periods</li>
<li>Optimization criterion used during model training</li>
<li>Heavily penalizes large errors (squared term)</li>
<li>Maintains original units² (dollars²)</li>
</ul>
</section>
<section id="root-mean-squared-error-rmse" class="level3">
<h3 class="anchored" data-anchor-id="root-mean-squared-error-rmse">2. Root Mean Squared Error (RMSE)</h3>
<p><span class="math display">\[\text{RMSE} = \sqrt{\frac{1}{n}\sum_{t=1}^{n} (y_t - \hat{y}_t)^2}\]</span></p>
<ul>
<li>Returns to original units (dollars) for interpretability</li>
<li>Standard metric in forecasting literature</li>
<li>Penalizes large errors more than small ones</li>
<li>Normalized by sample size</li>
</ul>
</section>
<section id="mean-absolute-error-mae" class="level3">
<h3 class="anchored" data-anchor-id="mean-absolute-error-mae">3. Mean Absolute Error (MAE)</h3>
<p><span class="math display">\[\text{MAE} = \frac{1}{n}\sum_{t=1}^{n} |y_t - \hat{y}_t|\]</span></p>
<ul>
<li>Robust to outliers (no squaring)</li>
<li>Represents average absolute deviation</li>
<li>Linear penalty (all errors weighted equally)</li>
<li>Intuitive interpretation</li>
</ul>
</section>
</section>
<section id="why-not-mape" class="level2">
<h2 class="anchored" data-anchor-id="why-not-mape">Why Not MAPE?</h2>
<p>We avoid MAPE (Mean Absolute Percentage Error) because:</p>
<ul>
<li>Undefined/infinite when actual values are zero or near-zero</li>
<li>Asymmetric (over-predictions penalized more than under-predictions)</li>
<li>Not suitable for data with varying scales</li>
</ul>
</section>
<section id="interpreting-the-relationship" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-relationship">Interpreting the Relationship</h2>
<p><strong>If RMSE &gt;&gt; MAE</strong>: Large outlier errors dominate</p>
<p><strong>If RMSE ≈ MAE</strong>: Errors are relatively consistent</p>
<hr>
</section>
<section id="comparison-additive-vs-multiplicative-seasonality-theory" class="level2">
<h2 class="anchored" data-anchor-id="comparison-additive-vs-multiplicative-seasonality-theory">Comparison Additive vs Multiplicative Seasonality (Theory)</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Additive</th>
<th>Multiplicative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seasonality is independent of the series level</td>
<td>Seasonality scales with the level</td>
</tr>
<tr class="even">
<td>Peaks and dips are about the same size every season</td>
<td>Peaks get bigger when the series gets bigger</td>
</tr>
<tr class="odd">
<td>E.g. Temperature Time Series, rainfall in mm, energy usage in kWh</td>
<td>Retail sales, revenue, website traffic</td>
</tr>
<tr class="even">
<td>If seasonality looks like a fixed number</td>
<td>If it looks like a fixed percentage</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Primary Result
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Method 2 (Aggregate-then-Disaggregate) outperformed Method 1 (Direct Forecasting)</strong> with an RMSE improvement of <strong>15.22 (3.96%)</strong> for Store 1, Department 1.</p>
</div>
</div>
<section id="why-did-method-2-win" class="level3">
<h3 class="anchored" data-anchor-id="why-did-method-2-win">Why Did Method 2 Win?</h3>
<ol type="1">
<li><strong>Noise Reduction</strong>: Aggregating across departments smoothed volatility and irregular patterns</li>
<li><strong>Stable Proportions</strong>: Department 1 maintained a consistent share of total store sales</li>
<li><strong>Stronger Signal</strong>: Store-level seasonal patterns were clearer and more predictable</li>
</ol>
</section>
<section id="when-would-method-1-be-better" class="level3">
<h3 class="anchored" data-anchor-id="when-would-method-1-be-better">When Would Method 1 Be Better?</h3>
<p>Method 1 (Direct Forecasting) would likely outperform Method 2 in scenarios with:</p>
<ul>
<li><strong>Unique Seasonal Patterns</strong>: Departments with seasonality different from the store average</li>
<li><strong>Structural Changes</strong>: Recent department-specific events (renovations, new product lines)</li>
<li><strong>Unstable Proportions</strong>: Departments whose share of store sales fluctuates significantly</li>
<li><strong>Large Departments</strong>: Departments representing substantial portions of store sales with distinct behavior</li>
</ul>
</section>
</section>
<section id="generalizability" class="level2">
<h2 class="anchored" data-anchor-id="generalizability">Generalizability</h2>
<p>This analysis suggests <strong>Method 2 may be preferred</strong> for:</p>
<ul>
<li>Stable, mature departments with consistent historical patterns</li>
<li>Departments representing small, steady shares of total store sales</li>
<li>Scenarios where reducing forecast variance is critical (e.g., inventory planning)</li>
<li>Contexts with limited department-specific data</li>
</ul>
<p><strong>Method 1 may be preferred</strong> for:</p>
<ul>
<li>Large departments with strong individual identity</li>
<li>Departments undergoing transformation or growth</li>
<li>Situations requiring granular, department-specific insights</li>
</ul>
</section>
<section id="limitations-and-future-work" class="level2">
<h2 class="anchored" data-anchor-id="limitations-and-future-work">Limitations and Future Work</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Study Limitations
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Analysis limited to Store 1, Department 1</li>
<li>Test period covers only 4 weeks</li>
<li>Holt-Winters model does not capture promotional effects or external factors</li>
<li>No cross-validation across multiple departments/stores</li>
</ul>
</div>
</div>
<section id="recommended-extensions" class="level3">
<h3 class="anchored" data-anchor-id="recommended-extensions">Recommended Extensions</h3>
<ol type="1">
<li><strong>Broader Testing</strong>: Replicate analysis across all stores and departments</li>
<li><strong>Alternative Models</strong>: Test ARIMA, Prophet, LSTM for potential improvements</li>
<li><strong>Exogenous Variables</strong>: Incorporate holidays, promotions, economic indicators</li>
<li><strong>Longer Horizons</strong>: Evaluate forecast accuracy over multi-week periods</li>
<li><strong>Hybrid Approaches</strong>: Combine methods or use ensemble forecasting</li>
</ol>
</section>
</section>
<section id="practical-implications" class="level2">
<h2 class="anchored" data-anchor-id="practical-implications">Practical Implications</h2>
<p>For <strong>retail forecasting practitioners</strong>:</p>
<ul>
<li>Don’t assume direct department-level forecasting is always superior</li>
<li>Test both methods on your specific data before deciding</li>
<li>Consider department characteristics (size, stability, uniqueness)</li>
<li>Aggregate-then-disaggregate can be surprisingly effective for stable departments</li>
<li>Computational efficiency: Method 2 requires fewer models (1 per store vs.&nbsp;1 per store-department combination)</li>
</ul>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<section id="data-source" class="level2">
<h2 class="anchored" data-anchor-id="data-source">Data Source</h2>
<ul>
<li><strong>Walmart Store Sales Forecasting</strong>: Kaggle Competition Dataset</li>
<li>Historical weekly sales data for multiple stores and departments</li>
</ul>
</section>
<section id="methodology-references" class="level2">
<h2 class="anchored" data-anchor-id="methodology-references">Methodology References</h2>
<ul>
<li>Holt, C. C. (2004). “Forecasting seasonals and trends by exponentially weighted moving averages”</li>
<li>Winters, P. R. (1960). “Forecasting sales by exponentially weighted moving averages”</li>
<li>Hyndman, R. J., &amp; Athanasopoulos, G. (2021). “Forecasting: Principles and Practice” (3rd ed.)</li>
</ul>
</section>
<section id="statistical-tests" class="level2">
<h2 class="anchored" data-anchor-id="statistical-tests">Statistical Tests</h2>
<ul>
<li>Augmented Dickey-Fuller Test for stationarity(We can make some conclusion for trend based on that as well)</li>
<li>KPSS Test for trend-stationarity (Same logic with ADF test)</li>
<li>Mann-Kendall Trend Test(Checking if there is a monotonic trend)</li>
<li>Linear Regression Slope Test(Is the mean changing linearly with time?)</li>
<li>Cox-Stuart Test(Is the second half systematically larger than the first?)</li>
<li>Spearman’s Rank Correlation Test(Is there any monotonic relationship between time and value?)</li>
</ul>
<hr>
</section>
</section>
<section id="appendix-code-repository" class="level1">
<h1>Appendix: Code Repository</h1>
<p>All code, data, and analysis files are available in the project repository:</p>
<pre><code>PROJECT/
├── data/
│   └── train.csv
├──my quarto/
    └── Part1.qmd
    └──run_trend_analysis.py
├──Part1_Comparing_HigherLevel_UnitLevel.ipynb # Same logic, same code with quarto doc
└── requirements.txt</code></pre>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pandas&gt;=1.3.0</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>numpy&gt;=1.21.0</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>matplotlib&gt;=3.4.0</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>seaborn&gt;=0.11.0</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>scipy&gt;=1.7.0</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>statsmodels&gt;=0.13.0</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>pymannkendall&gt;=1.4.0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="session-information" class="level2">
<h2 class="anchored" data-anchor-id="session-information">Session Information</h2>
<div id="4f31ac46" class="cell" data-execution_count="25">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version: </span><span class="sc">{</span>sys<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pandas version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Python version: 3.10.0 (tags/v3.10.0:b494f59, Oct  4 2021, 19:00:18) [MSC v.1929 64 bit (AMD64)]
Pandas version: 2.3.3
NumPy version: 2.2.6</code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reproducibility Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This entire analysis can be reproduced by running:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">quarto</span> render Part1.qmd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All random seeds (if applicable) and data processing steps are documented in the code blocks above.</p>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb47" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Time Series Forecasting: Walmart Sales Analysis Part 1"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Comparing Aggregate vs. Direct Department-Level Forecasting"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Costin-Andrei Taulescu &amp; Panagiotis Valsamis"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 12</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 6</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">    colorlinks: true</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executive Summary</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>This is the part 1 of the project and explores time series forecasting using Walmart's historical sales data. We compare two forecasting approaches:</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Method 1**: Direct forecasting at the department level</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Method 2**: Forecasting at an aggregated store level, then disaggregating to departments</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>The analysis focuses on Store 1, Department 1, using Holt-Winters seasonal exponential smoothing models.</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Finding</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>Method 2 (Aggregate-then-Disaggregate) outperformed Method 1 (Direct Forecasting) with an RMSE improvement of 15.22 (3.96%), demonstrating that aggregation can reduce noise and improve forecast accuracy for stable departments.</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Reproducibility Setup</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Environment Setup</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>We recommend creating a virtual environment to ensure reproducible results.</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Windows</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv ts_workshop_env</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="ex">ts_workshop_env\Scripts\activate</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## macOS/Linux</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> venv ts_workshop_env</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ts_workshop_env/bin/activate</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Required Libraries</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta    </span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller, kpss</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymannkendall <span class="im">as</span> mk</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings for cleaner output</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plotting style</span></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn-v0_8-darkgrid'</span>)</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Overview</span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading the Dataset</span></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Load training data</span></span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"../data/train.csv"</span>)</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dataset shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First few rows:"</span>)</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Statistical summary:"</span>)</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe())</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data types and null counts:"</span>)</span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.info())</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Missing values:"</span>)</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isnull().<span class="bu">sum</span>())</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Quality: Handling Negative Sales</span></span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Issue Detected</span></span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>The dataset contains negative values in <span class="in">`Weekly_Sales`</span>, which are not meaningful in this context. We will set these to zero.</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_negative_values_zero(df, column_name):</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Set negative values in a column to zero."""</span></span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>    df.loc[df[column_name] <span class="op">&lt;</span> <span class="dv">0</span>, column_name] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> negative_values(df, column_name):</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Filter rows with negative values in a column."""</span></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[df[column_name] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a><span class="fu"># Focus: Store 1 Analysis</span></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a>For this analysis, we focus exclusively on Store 1 to compare forecasting methods.</span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Store 1</span></span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>df_store_1 <span class="op">=</span> df[df[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>df_store_1 <span class="op">=</span> make_negative_values_zero(df_store_1, <span class="st">"Weekly_Sales"</span>)</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Store 1 data shape: </span><span class="sc">{</span>df_store_1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Departments in Store 1:"</span>)</span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_store_1[<span class="st">"Dept"</span>].value_counts().sort_index())</span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a><span class="fu">## Train-Test Split</span></span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Date to datetime</span></span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a>df_store_1[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df_store_1[<span class="st">'Date'</span>])</span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Define test period: last 4 weeks</span></span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a>max_date <span class="op">=</span> df_store_1[<span class="st">'Date'</span>].<span class="bu">max</span>()</span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a>test_start_date <span class="op">=</span> max_date <span class="op">-</span> pd.Timedelta(weeks<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training data: Up to </span><span class="sc">{</span>test_start_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test data: </span><span class="sc">{</span>test_start_date<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>max_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a>df_store_1_train <span class="op">=</span> df_store_1[df_store_1[<span class="st">'Date'</span>] <span class="op">&lt;</span> test_start_date].copy()</span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a>df_store_1_test <span class="op">=</span> df_store_1[df_store_1[<span class="st">'Date'</span>] <span class="op">&gt;=</span> test_start_date].copy()</span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a><span class="fu"># Method 2: Aggregate-then-Disaggregate</span></span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Aggregate Store-Level Sales</span></span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-aggregated-sales</span></span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Store 1 Aggregated Weekly Sales (Training Period)"</span></span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate all departments by date</span></span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a>store_1_aggregated_train <span class="op">=</span> df_store_1_train.groupby(<span class="st">'Date'</span>).agg({</span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Weekly_Sales'</span>: <span class="st">'sum'</span></span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a>store_1_aggregated_test <span class="op">=</span> df_store_1_test.groupby(<span class="st">'Date'</span>).agg({</span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Weekly_Sales'</span>: <span class="st">'sum'</span></span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a>store_1_aggregated <span class="op">=</span> store_1_aggregated_train.sort_values(<span class="st">'Date'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize aggregated sales</span></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated[<span class="st">'Date'</span>], </span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Aggregated Weekly Sales Over Time (Training Set)'</span>, </span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initial Observations</span></span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a><span class="fu">## Seasonal Patterns Observed</span></span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clear peaks at year-end (holiday shopping)</span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consistent troughs at year start (post-holiday slowdown)</span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regular seasonal cycle without strong trend</span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Statistical Tests for Trend</span></span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a>Before modeling, we test whether the series exhibits a significant trend.</span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a><span class="fu">## Notes for Statistical Tests</span></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Why we used stationary test (ADF,KPSS) for checking for trend? Stationary series has constant mean, an increasing or decreasing trend violates this definition.</span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>MANN-KENDALL test and COX-STUART test are mainly used for identifying trend.</span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> run_trend_analysis <span class="im">import</span> analyze_series</span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a>df_store_for_tests <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>]</span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> analyze_series(df_store_for_tests, series_name<span class="op">=</span><span class="st">"Store 1"</span>)</span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trend Analysis Conclusion</span></span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a>Mixed results from statistical tests suggest weak or no persistent trend. Visual inspection confirms regular seasonality without long-term increase/decrease. Therefore, we use **Holt-Winters Seasonal (No Trend)** model.</span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Holt-Winters</span></span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a>Holt Winters uses exponential smoothing to assign more weight to recent observations while reducing the influence of older data. This method ensures that the model is responsive to recent changes in seanlity or trends(here we assumed no trend), making it ideal for scenarios where the latest data is the most relevant for forecasting.</span>
<span id="cb47-256"><a href="#cb47-256" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a><span class="fu">## Holt–Winters (Additive) Formulas</span></span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a><span class="fu">### Updating equations</span></span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a>L_t = \alpha (y_t - S_{t-m}) + (1-\alpha)(L_{t-1}+T_{t-1})</span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a>T_t = \beta (L_t - L_{t-1}) + (1-\beta)T_{t-1}</span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a>S_t = \gamma (y_t - L_t) + (1-\gamma) S_{t-m}</span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecast</span></span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-278"><a href="#cb47-278" aria-hidden="true" tabindex="-1"></a>\hat y_{t+h} = L_t + hT_t + S_{t+h-mk},</span>
<span id="cb47-279"><a href="#cb47-279" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a>k=\left\lfloor \frac{h-1}{m} \right\rfloor</span>
<span id="cb47-281"><a href="#cb47-281" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-282"><a href="#cb47-282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-283"><a href="#cb47-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-284"><a href="#cb47-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a>**Benefits:** </span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Balances recent and historical data. As we said it uses exponential smoothing to prioritize recent observations while still incorporating historical data. </span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-290"><a href="#cb47-290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lower computational power. Compared to other machine learning and deep learning models requires by far less computational power and resources.</span>
<span id="cb47-291"><a href="#cb47-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a>**Drawbacks:**</span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sensitivity to parameter tuning. It requires grid search of the parameters in order not to provide inaccurate parameters.</span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is not performing very well in non-linear patterns. While it performs well on datasets with clear trends and seasonal cycles it is not suited for datasets where exhibits non-linear growth or decline.</span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-301"><a href="#cb47-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Holt-Winters Forecasting (Additive Seasonality)</span></span>
<span id="cb47-302"><a href="#cb47-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> TSE(y_true, y_pred):</span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Total Squared Error"""</span></span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>((y_true <span class="op">-</span> y_pred)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_seasonal_no_trend(y, alpha, gamma, m):</span>
<span id="cb47-311"><a href="#cb47-311" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb47-312"><a href="#cb47-312" aria-hidden="true" tabindex="-1"></a><span class="co">    Holt-Winters Seasonal Method without Trend (Additive)</span></span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a><span class="co">    - y: time series data</span></span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a><span class="co">    - alpha: level smoothing parameter</span></span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a><span class="co">    - gamma: seasonal smoothing parameter</span></span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a><span class="co">    - m: season length (52 for weekly data with yearly seasonality)</span></span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialization</span></span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a>    level <span class="op">=</span> np.mean(y[:m])</span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a>    seasonals <span class="op">=</span> <span class="bu">list</span>(y[:m] <span class="op">-</span> level)</span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a>    fitted <span class="op">=</span> [np.nan] <span class="op">*</span> n</span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(m, n):</span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a>        fitted[t] <span class="op">=</span> level <span class="op">+</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-331"><a href="#cb47-331" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> alpha <span class="op">*</span> (y[t] <span class="op">-</span> seasonals[t <span class="op">-</span> m]) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">*</span> level</span>
<span id="cb47-332"><a href="#cb47-332" aria-hidden="true" tabindex="-1"></a>        new_seasonal <span class="op">=</span> gamma <span class="op">*</span> (y[t] <span class="op">-</span> new_level) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> gamma) <span class="op">*</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> new_level</span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a>        seasonals.append(new_seasonal)</span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(fitted), level, seasonals</span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grid Search for Optimal Parameters</span></span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-345"><a href="#cb47-345" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-346"><a href="#cb47-346" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span>  <span class="co"># Weekly data, yearly seasonality</span></span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a>gammas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb47-352"><a href="#cb47-352" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-353"><a href="#cb47-353" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Running grid search for optimal parameters..."</span>)</span>
<span id="cb47-356"><a href="#cb47-356" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb47-357"><a href="#cb47-357" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend(y_train, alpha, gamma, m)</span>
<span id="cb47-359"><a href="#cb47-359" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-360"><a href="#cb47-360" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb47-361"><a href="#cb47-361" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train[valid_idx], fitted[valid_idx])</span>
<span id="cb47-362"><a href="#cb47-362" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-363"><a href="#cb47-363" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb47-364"><a href="#cb47-364" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb47-365"><a href="#cb47-365" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb47-366"><a href="#cb47-366" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb47-367"><a href="#cb47-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-368"><a href="#cb47-368" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-369"><a href="#cb47-369" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best TSE (training): </span><span class="sc">{</span>best_tse<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-370"><a href="#cb47-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-371"><a href="#cb47-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-372"><a href="#cb47-372" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generate Forecasts</span></span>
<span id="cb47-373"><a href="#cb47-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-376"><a href="#cb47-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-377"><a href="#cb47-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hw-additive</span></span>
<span id="cb47-378"><a href="#cb47-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Holt-Winters Additive Forecast vs Actuals"</span></span>
<span id="cb47-379"><a href="#cb47-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-380"><a href="#cb47-380" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(store_1_aggregated_test)</span>
<span id="cb47-381"><a href="#cb47-381" aria-hidden="true" tabindex="-1"></a>alpha_best, gamma_best <span class="op">=</span> best_params</span>
<span id="cb47-382"><a href="#cb47-382" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb47-383"><a href="#cb47-383" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb47-384"><a href="#cb47-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-385"><a href="#cb47-385" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> []</span>
<span id="cb47-386"><a href="#cb47-386" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb47-387"><a href="#cb47-387" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb47-388"><a href="#cb47-388" aria-hidden="true" tabindex="-1"></a>    forecast.append(level <span class="op">+</span> seasonals[seasonal_index])</span>
<span id="cb47-389"><a href="#cb47-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-390"><a href="#cb47-390" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> np.array(forecast)</span>
<span id="cb47-391"><a href="#cb47-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-392"><a href="#cb47-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb47-393"><a href="#cb47-393" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> store_1_aggregated_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-394"><a href="#cb47-394" aria-hidden="true" tabindex="-1"></a>tse_test <span class="op">=</span> TSE(y_test, forecast)</span>
<span id="cb47-395"><a href="#cb47-395" aria-hidden="true" tabindex="-1"></a>rmse_test <span class="op">=</span> np.sqrt(np.mean((y_test <span class="op">-</span> forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb47-396"><a href="#cb47-396" aria-hidden="true" tabindex="-1"></a>mae_test <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test <span class="op">-</span> forecast))</span>
<span id="cb47-397"><a href="#cb47-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-398"><a href="#cb47-398" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test TSE: </span><span class="sc">{</span>tse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-399"><a href="#cb47-399" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-400"><a href="#cb47-400" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test MAE: </span><span class="sc">{</span>mae_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-401"><a href="#cb47-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-402"><a href="#cb47-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb47-403"><a href="#cb47-403" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-404"><a href="#cb47-404" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_train[<span class="st">'Date'</span>], </span>
<span id="cb47-405"><a href="#cb47-405" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_train[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb47-406"><a href="#cb47-406" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb47-407"><a href="#cb47-407" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb47-408"><a href="#cb47-408" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb47-409"><a href="#cb47-409" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-410"><a href="#cb47-410" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-411"><a href="#cb47-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-412"><a href="#cb47-412" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>], </span>
<span id="cb47-413"><a href="#cb47-413" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb47-414"><a href="#cb47-414" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data'</span>,</span>
<span id="cb47-415"><a href="#cb47-415" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-416"><a href="#cb47-416" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb47-417"><a href="#cb47-417" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-418"><a href="#cb47-418" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-419"><a href="#cb47-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-420"><a href="#cb47-420" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-421"><a href="#cb47-421" aria-hidden="true" tabindex="-1"></a>         forecast,</span>
<span id="cb47-422"><a href="#cb47-422" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Holt-Winters Forecast (Additive)'</span>,</span>
<span id="cb47-423"><a href="#cb47-423" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-424"><a href="#cb47-424" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb47-425"><a href="#cb47-425" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-426"><a href="#cb47-426" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)   </span>
<span id="cb47-427"><a href="#cb47-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-428"><a href="#cb47-428" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-429"><a href="#cb47-429" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)    </span>
<span id="cb47-430"><a href="#cb47-430" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Holt-Winters Seasonal Forecast vs Actuals (Additive)'</span>, </span>
<span id="cb47-431"><a href="#cb47-431" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-432"><a href="#cb47-432" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-433"><a href="#cb47-433" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-434"><a href="#cb47-434" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-435"><a href="#cb47-435" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-436"><a href="#cb47-436" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-437"><a href="#cb47-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-438"><a href="#cb47-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Store results</span></span>
<span id="cb47-439"><a href="#cb47-439" aria-hidden="true" tabindex="-1"></a>additive_results <span class="op">=</span> {</span>
<span id="cb47-440"><a href="#cb47-440" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb47-441"><a href="#cb47-441" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb47-442"><a href="#cb47-442" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb47-443"><a href="#cb47-443" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test,</span>
<span id="cb47-444"><a href="#cb47-444" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test,</span>
<span id="cb47-445"><a href="#cb47-445" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test,</span>
<span id="cb47-446"><a href="#cb47-446" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast.copy()</span>
<span id="cb47-447"><a href="#cb47-447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-448"><a href="#cb47-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-449"><a href="#cb47-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-450"><a href="#cb47-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-451"><a href="#cb47-451" aria-hidden="true" tabindex="-1"></a><span class="fu">### Better Visualization of the prediction(Additive)</span></span>
<span id="cb47-452"><a href="#cb47-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-455"><a href="#cb47-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-456"><a href="#cb47-456" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb47-457"><a href="#cb47-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-458"><a href="#cb47-458" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb47-459"><a href="#cb47-459" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-460"><a href="#cb47-460" aria-hidden="true" tabindex="-1"></a>    y_test,</span>
<span id="cb47-461"><a href="#cb47-461" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb47-462"><a href="#cb47-462" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-463"><a href="#cb47-463" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-464"><a href="#cb47-464" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-465"><a href="#cb47-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-466"><a href="#cb47-466" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb47-467"><a href="#cb47-467" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-468"><a href="#cb47-468" aria-hidden="true" tabindex="-1"></a>    forecast,</span>
<span id="cb47-469"><a href="#cb47-469" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Holt–Winters Forecast(Additive Seasonal, No Trend)'</span>,</span>
<span id="cb47-470"><a href="#cb47-470" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-471"><a href="#cb47-471" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-472"><a href="#cb47-472" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-473"><a href="#cb47-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-474"><a href="#cb47-474" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb47-475"><a href="#cb47-475" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales'</span>)</span>
<span id="cb47-476"><a href="#cb47-476" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Holt–Winters Forecast vs Actuals (Test Set) Additive Seasonal, No Trend'</span>)</span>
<span id="cb47-477"><a href="#cb47-477" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-478"><a href="#cb47-478" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-479"><a href="#cb47-479" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-480"><a href="#cb47-480" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-481"><a href="#cb47-481" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-482"><a href="#cb47-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-483"><a href="#cb47-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-484"><a href="#cb47-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-485"><a href="#cb47-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-486"><a href="#cb47-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-487"><a href="#cb47-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Alternative Model - Multiplicative Seasonality</span></span>
<span id="cb47-488"><a href="#cb47-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-491"><a href="#cb47-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-492"><a href="#cb47-492" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_seasonal_no_trend_multiplicative(y, alpha, gamma, m):</span>
<span id="cb47-493"><a href="#cb47-493" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb47-494"><a href="#cb47-494" aria-hidden="true" tabindex="-1"></a><span class="co">    Holt-Winters Seasonal Method without Trend - Multiplicative Seasonality</span></span>
<span id="cb47-495"><a href="#cb47-495" aria-hidden="true" tabindex="-1"></a><span class="co">    y: time series data</span></span>
<span id="cb47-496"><a href="#cb47-496" aria-hidden="true" tabindex="-1"></a><span class="co">    alpha: level smoothing parameter</span></span>
<span id="cb47-497"><a href="#cb47-497" aria-hidden="true" tabindex="-1"></a><span class="co">    gamma: seasonal smoothing parameter</span></span>
<span id="cb47-498"><a href="#cb47-498" aria-hidden="true" tabindex="-1"></a><span class="co">    m: season length</span></span>
<span id="cb47-499"><a href="#cb47-499" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb47-500"><a href="#cb47-500" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-501"><a href="#cb47-501" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb47-502"><a href="#cb47-502" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-503"><a href="#cb47-503" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialization</span></span>
<span id="cb47-504"><a href="#cb47-504" aria-hidden="true" tabindex="-1"></a>    level <span class="op">=</span> np.mean(y[:m])</span>
<span id="cb47-505"><a href="#cb47-505" aria-hidden="true" tabindex="-1"></a>    seasonals <span class="op">=</span> <span class="bu">list</span>(y[:m] <span class="op">/</span> level)  <span class="co"># Multiplicative: divide instead of subtract</span></span>
<span id="cb47-506"><a href="#cb47-506" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-507"><a href="#cb47-507" aria-hidden="true" tabindex="-1"></a>    fitted <span class="op">=</span> [np.nan] <span class="op">*</span> n</span>
<span id="cb47-508"><a href="#cb47-508" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-509"><a href="#cb47-509" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(m, n):</span>
<span id="cb47-510"><a href="#cb47-510" aria-hidden="true" tabindex="-1"></a>        fitted[t] <span class="op">=</span> level <span class="op">*</span> seasonals[t <span class="op">-</span> m]  <span class="co"># Multiplicative: multiply instead of add</span></span>
<span id="cb47-511"><a href="#cb47-511" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-512"><a href="#cb47-512" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update level (deseasonalize by dividing)</span></span>
<span id="cb47-513"><a href="#cb47-513" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> alpha <span class="op">*</span> (y[t] <span class="op">/</span> seasonals[t <span class="op">-</span> m]) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">*</span> level</span>
<span id="cb47-514"><a href="#cb47-514" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-515"><a href="#cb47-515" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update seasonal component (ratio)</span></span>
<span id="cb47-516"><a href="#cb47-516" aria-hidden="true" tabindex="-1"></a>        new_seasonal <span class="op">=</span> gamma <span class="op">*</span> (y[t] <span class="op">/</span> new_level) <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> gamma) <span class="op">*</span> seasonals[t <span class="op">-</span> m]</span>
<span id="cb47-517"><a href="#cb47-517" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-518"><a href="#cb47-518" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> new_level</span>
<span id="cb47-519"><a href="#cb47-519" aria-hidden="true" tabindex="-1"></a>        seasonals.append(new_seasonal)</span>
<span id="cb47-520"><a href="#cb47-520" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-521"><a href="#cb47-521" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(fitted), level, seasonals</span>
<span id="cb47-522"><a href="#cb47-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-523"><a href="#cb47-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-524"><a href="#cb47-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid search for optimal parameters</span></span>
<span id="cb47-525"><a href="#cb47-525" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> store_1_aggregated_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-526"><a href="#cb47-526" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span></span>
<span id="cb47-527"><a href="#cb47-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-528"><a href="#cb47-528" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb47-529"><a href="#cb47-529" aria-hidden="true" tabindex="-1"></a>gammas <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">1.0</span>, <span class="fl">0.05</span>)</span>
<span id="cb47-530"><a href="#cb47-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-531"><a href="#cb47-531" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb47-532"><a href="#cb47-532" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-533"><a href="#cb47-533" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-534"><a href="#cb47-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-535"><a href="#cb47-535" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb47-536"><a href="#cb47-536" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb47-537"><a href="#cb47-537" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend_multiplicative(</span>
<span id="cb47-538"><a href="#cb47-538" aria-hidden="true" tabindex="-1"></a>            y_train, alpha, gamma, m</span>
<span id="cb47-539"><a href="#cb47-539" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-540"><a href="#cb47-540" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-541"><a href="#cb47-541" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb47-542"><a href="#cb47-542" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train[valid_idx], fitted[valid_idx])</span>
<span id="cb47-543"><a href="#cb47-543" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-544"><a href="#cb47-544" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb47-545"><a href="#cb47-545" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb47-546"><a href="#cb47-546" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb47-547"><a href="#cb47-547" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb47-548"><a href="#cb47-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-549"><a href="#cb47-549" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-550"><a href="#cb47-550" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best TSE (training): </span><span class="sc">{</span>best_tse<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-551"><a href="#cb47-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-552"><a href="#cb47-552" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting</span></span>
<span id="cb47-553"><a href="#cb47-553" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(store_1_aggregated_test)</span>
<span id="cb47-554"><a href="#cb47-554" aria-hidden="true" tabindex="-1"></a>alpha_best, gamma_best <span class="op">=</span> best_params</span>
<span id="cb47-555"><a href="#cb47-555" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb47-556"><a href="#cb47-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-557"><a href="#cb47-557" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb47-558"><a href="#cb47-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-559"><a href="#cb47-559" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> []</span>
<span id="cb47-560"><a href="#cb47-560" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb47-561"><a href="#cb47-561" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb47-562"><a href="#cb47-562" aria-hidden="true" tabindex="-1"></a>    forecast.append(level <span class="op">*</span> seasonals[seasonal_index])  <span class="co"># Multiplicative</span></span>
<span id="cb47-563"><a href="#cb47-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-564"><a href="#cb47-564" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> np.array(forecast)</span>
<span id="cb47-565"><a href="#cb47-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-566"><a href="#cb47-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb47-567"><a href="#cb47-567" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> store_1_aggregated_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-568"><a href="#cb47-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-569"><a href="#cb47-569" aria-hidden="true" tabindex="-1"></a>tse_test <span class="op">=</span> TSE(y_test, forecast)</span>
<span id="cb47-570"><a href="#cb47-570" aria-hidden="true" tabindex="-1"></a>rmse_test <span class="op">=</span> np.sqrt(np.mean((y_test <span class="op">-</span> forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb47-571"><a href="#cb47-571" aria-hidden="true" tabindex="-1"></a>mae_test <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test <span class="op">-</span> forecast))</span>
<span id="cb47-572"><a href="#cb47-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-573"><a href="#cb47-573" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test TSE: </span><span class="sc">{</span>tse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-574"><a href="#cb47-574" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-575"><a href="#cb47-575" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test MAE: </span><span class="sc">{</span>mae_test<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-576"><a href="#cb47-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-577"><a href="#cb47-577" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb47-578"><a href="#cb47-578" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-579"><a href="#cb47-579" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_train[<span class="st">'Date'</span>], </span>
<span id="cb47-580"><a href="#cb47-580" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_train[<span class="st">'Weekly_Sales'</span>], </span>
<span id="cb47-581"><a href="#cb47-581" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb47-582"><a href="#cb47-582" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb47-583"><a href="#cb47-583" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb47-584"><a href="#cb47-584" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-585"><a href="#cb47-585" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-586"><a href="#cb47-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-587"><a href="#cb47-587" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>], </span>
<span id="cb47-588"><a href="#cb47-588" aria-hidden="true" tabindex="-1"></a>         store_1_aggregated_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb47-589"><a href="#cb47-589" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data'</span>,</span>
<span id="cb47-590"><a href="#cb47-590" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-591"><a href="#cb47-591" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb47-592"><a href="#cb47-592" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-593"><a href="#cb47-593" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-594"><a href="#cb47-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-595"><a href="#cb47-595" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-596"><a href="#cb47-596" aria-hidden="true" tabindex="-1"></a>         forecast,</span>
<span id="cb47-597"><a href="#cb47-597" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Holt-Winters Forecast (Multiplicative)'</span>,</span>
<span id="cb47-598"><a href="#cb47-598" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-599"><a href="#cb47-599" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb47-600"><a href="#cb47-600" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-601"><a href="#cb47-601" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)   </span>
<span id="cb47-602"><a href="#cb47-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-603"><a href="#cb47-603" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-604"><a href="#cb47-604" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)    </span>
<span id="cb47-605"><a href="#cb47-605" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1: Holt-Winters Seasonal Forecast (Multiplicative) vs Actuals'</span>, </span>
<span id="cb47-606"><a href="#cb47-606" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-607"><a href="#cb47-607" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-608"><a href="#cb47-608" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-609"><a href="#cb47-609" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-610"><a href="#cb47-610" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-611"><a href="#cb47-611" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-612"><a href="#cb47-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-613"><a href="#cb47-613" aria-hidden="true" tabindex="-1"></a>multiplicative_results <span class="op">=</span> {</span>
<span id="cb47-614"><a href="#cb47-614" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb47-615"><a href="#cb47-615" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb47-616"><a href="#cb47-616" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb47-617"><a href="#cb47-617" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test,</span>
<span id="cb47-618"><a href="#cb47-618" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test,</span>
<span id="cb47-619"><a href="#cb47-619" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test,</span>
<span id="cb47-620"><a href="#cb47-620" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast.copy()  <span class="co"># Store the forecast</span></span>
<span id="cb47-621"><a href="#cb47-621" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-622"><a href="#cb47-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-623"><a href="#cb47-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-624"><a href="#cb47-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-625"><a href="#cb47-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-626"><a href="#cb47-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Better Visualization of the predictions(Multiplicative)</span></span>
<span id="cb47-629"><a href="#cb47-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-630"><a href="#cb47-630" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb47-631"><a href="#cb47-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-632"><a href="#cb47-632" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb47-633"><a href="#cb47-633" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-634"><a href="#cb47-634" aria-hidden="true" tabindex="-1"></a>    y_test,</span>
<span id="cb47-635"><a href="#cb47-635" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb47-636"><a href="#cb47-636" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-637"><a href="#cb47-637" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-638"><a href="#cb47-638" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-639"><a href="#cb47-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-640"><a href="#cb47-640" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb47-641"><a href="#cb47-641" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_test[<span class="st">'Date'</span>],</span>
<span id="cb47-642"><a href="#cb47-642" aria-hidden="true" tabindex="-1"></a>    forecast,</span>
<span id="cb47-643"><a href="#cb47-643" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Holt–Winters Forecast'</span>,</span>
<span id="cb47-644"><a href="#cb47-644" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-645"><a href="#cb47-645" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-646"><a href="#cb47-646" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-647"><a href="#cb47-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-648"><a href="#cb47-648" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb47-649"><a href="#cb47-649" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales'</span>)</span>
<span id="cb47-650"><a href="#cb47-650" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Holt–Winters Forecast vs Actuals (Test Set) - Multiplicative Seasonal, No Trend'</span>)</span>
<span id="cb47-651"><a href="#cb47-651" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-652"><a href="#cb47-652" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-653"><a href="#cb47-653" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-654"><a href="#cb47-654" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-655"><a href="#cb47-655" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-656"><a href="#cb47-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-657"><a href="#cb47-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-658"><a href="#cb47-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-659"><a href="#cb47-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-660"><a href="#cb47-660" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparison: Additive vs Multiplicative</span></span>
<span id="cb47-661"><a href="#cb47-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-664"><a href="#cb47-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-665"><a href="#cb47-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-additive-vs-mult</span></span>
<span id="cb47-666"><a href="#cb47-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Performance Comparison: Additive vs Multiplicative Seasonality"</span></span>
<span id="cb47-667"><a href="#cb47-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-668"><a href="#cb47-668" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb47-669"><a href="#cb47-669" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Metric'</span>: [<span class="st">'Alpha'</span>, <span class="st">'Gamma'</span>, <span class="st">'Train TSE'</span>, <span class="st">'Test TSE'</span>, <span class="st">'Test RMSE'</span>, <span class="st">'Test MAE'</span>],</span>
<span id="cb47-670"><a href="#cb47-670" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Additive'</span>: [</span>
<span id="cb47-671"><a href="#cb47-671" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'alpha'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-672"><a href="#cb47-672" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'gamma'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-673"><a href="#cb47-673" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'tse_train'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-674"><a href="#cb47-674" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-675"><a href="#cb47-675" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-676"><a href="#cb47-676" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>additive_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb47-677"><a href="#cb47-677" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb47-678"><a href="#cb47-678" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Multiplicative'</span>: [</span>
<span id="cb47-679"><a href="#cb47-679" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'alpha'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-680"><a href="#cb47-680" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'gamma'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-681"><a href="#cb47-681" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'tse_train'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-682"><a href="#cb47-682" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-683"><a href="#cb47-683" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-684"><a href="#cb47-684" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>multiplicative_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb47-685"><a href="#cb47-685" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb47-686"><a href="#cb47-686" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-687"><a href="#cb47-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-688"><a href="#cb47-688" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb47-689"><a href="#cb47-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-690"><a href="#cb47-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-691"><a href="#cb47-691" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-692"><a href="#cb47-692" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Selection</span></span>
<span id="cb47-693"><a href="#cb47-693" aria-hidden="true" tabindex="-1"></a>Both models produce nearly identical forecasts. This similarity occurs because seasonal fluctuations remain relatively constant in absolute terms. We proceed with the **additive model** for disaggregation.</span>
<span id="cb47-694"><a href="#cb47-694" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-695"><a href="#cb47-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-696"><a href="#cb47-696" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5: Disaggregation to Department Level</span></span>
<span id="cb47-697"><a href="#cb47-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-700"><a href="#cb47-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-701"><a href="#cb47-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dept-proportion</span></span>
<span id="cb47-702"><a href="#cb47-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Department 1 as Proportion of Store 1 Total Sales"</span></span>
<span id="cb47-703"><a href="#cb47-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-704"><a href="#cb47-704" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Department 1 data</span></span>
<span id="cb47-705"><a href="#cb47-705" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train <span class="op">=</span> df_store_1_train[</span>
<span id="cb47-706"><a href="#cb47-706" aria-hidden="true" tabindex="-1"></a>    (df_store_1_train[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_train[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb47-707"><a href="#cb47-707" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb47-708"><a href="#cb47-708" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train <span class="op">=</span> store_1_dept_1_train.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb47-709"><a href="#cb47-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-710"><a href="#cb47-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to calculate proportions</span></span>
<span id="cb47-711"><a href="#cb47-711" aria-hidden="true" tabindex="-1"></a>all_merged <span class="op">=</span> pd.merge(</span>
<span id="cb47-712"><a href="#cb47-712" aria-hidden="true" tabindex="-1"></a>    store_1_dept_1_train[[<span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]],</span>
<span id="cb47-713"><a href="#cb47-713" aria-hidden="true" tabindex="-1"></a>    store_1_aggregated_train[[<span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]],</span>
<span id="cb47-714"><a href="#cb47-714" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb47-715"><a href="#cb47-715" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">'_dept'</span>, <span class="st">'_store'</span>)</span>
<span id="cb47-716"><a href="#cb47-716" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-717"><a href="#cb47-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-718"><a href="#cb47-718" aria-hidden="true" tabindex="-1"></a>all_merged[<span class="st">'proportion'</span>] <span class="op">=</span> all_merged[<span class="st">'Weekly_Sales_dept'</span>] <span class="op">/</span> all_merged[<span class="st">'Weekly_Sales_store'</span>]</span>
<span id="cb47-719"><a href="#cb47-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-720"><a href="#cb47-720" aria-hidden="true" tabindex="-1"></a>avg_proportion <span class="op">=</span> all_merged[<span class="st">'proportion'</span>].mean()</span>
<span id="cb47-721"><a href="#cb47-721" aria-hidden="true" tabindex="-1"></a>std_proportion <span class="op">=</span> all_merged[<span class="st">'proportion'</span>].std()</span>
<span id="cb47-722"><a href="#cb47-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-723"><a href="#cb47-723" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1's proportion of Store 1 sales:"</span>)</span>
<span id="cb47-724"><a href="#cb47-724" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>avg_proportion<span class="sc">:.4f}</span><span class="ss"> (</span><span class="sc">{</span>avg_proportion<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb47-725"><a href="#cb47-725" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Std:  </span><span class="sc">{</span>std_proportion<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-726"><a href="#cb47-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-727"><a href="#cb47-727" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize proportion stability</span></span>
<span id="cb47-728"><a href="#cb47-728" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb47-729"><a href="#cb47-729" aria-hidden="true" tabindex="-1"></a>plt.plot(all_merged[<span class="st">'Date'</span>], all_merged[<span class="st">'proportion'</span>], </span>
<span id="cb47-730"><a href="#cb47-730" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb47-731"><a href="#cb47-731" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb47-732"><a href="#cb47-732" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f'Mean: </span><span class="sc">{</span>avg_proportion<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb47-733"><a href="#cb47-733" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion <span class="op">+</span> std_proportion, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb47-734"><a href="#cb47-734" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'±1 Std Dev'</span>)</span>
<span id="cb47-735"><a href="#cb47-735" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>avg_proportion <span class="op">-</span> std_proportion, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb47-736"><a href="#cb47-736" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-737"><a href="#cb47-737" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-738"><a href="#cb47-738" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Department 1 Proportion'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-739"><a href="#cb47-739" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Department 1 as Proportion of Store 1 Total Sales (Training Period)'</span>, </span>
<span id="cb47-740"><a href="#cb47-740" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-741"><a href="#cb47-741" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-742"><a href="#cb47-742" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-743"><a href="#cb47-743" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-744"><a href="#cb47-744" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-745"><a href="#cb47-745" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-746"><a href="#cb47-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-747"><a href="#cb47-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-748"><a href="#cb47-748" aria-hidden="true" tabindex="-1"></a><span class="fu">### Apply Disaggregation</span></span>
<span id="cb47-749"><a href="#cb47-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-752"><a href="#cb47-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-753"><a href="#cb47-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-method2-forecast</span></span>
<span id="cb47-754"><a href="#cb47-754" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Method 2: Disaggregated Forecast for Department 1"</span></span>
<span id="cb47-755"><a href="#cb47-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-756"><a href="#cb47-756" aria-hidden="true" tabindex="-1"></a><span class="co"># Disaggregate store-level forecast</span></span>
<span id="cb47-757"><a href="#cb47-757" aria-hidden="true" tabindex="-1"></a>dept_1_forecast <span class="op">=</span> additive_results[<span class="st">'forecast'</span>] <span class="op">*</span> avg_proportion</span>
<span id="cb47-758"><a href="#cb47-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-759"><a href="#cb47-759" aria-hidden="true" tabindex="-1"></a><span class="co"># Get actual Department 1 test data</span></span>
<span id="cb47-760"><a href="#cb47-760" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_test <span class="op">=</span> df_store_1_test[</span>
<span id="cb47-761"><a href="#cb47-761" aria-hidden="true" tabindex="-1"></a>    (df_store_1_test[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_test[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb47-762"><a href="#cb47-762" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb47-763"><a href="#cb47-763" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_test <span class="op">=</span> store_1_dept_1_test.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb47-764"><a href="#cb47-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-765"><a href="#cb47-765" aria-hidden="true" tabindex="-1"></a>y_test_dept_1 <span class="op">=</span> store_1_dept_1_test[<span class="st">'Weekly_Sales'</span>].values</span>
<span id="cb47-766"><a href="#cb47-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-767"><a href="#cb47-767" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb47-768"><a href="#cb47-768" aria-hidden="true" tabindex="-1"></a>tse_dept_1 <span class="op">=</span> TSE(y_test_dept_1, dept_1_forecast)</span>
<span id="cb47-769"><a href="#cb47-769" aria-hidden="true" tabindex="-1"></a>rmse_dept_1 <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1 <span class="op">-</span> dept_1_forecast) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb47-770"><a href="#cb47-770" aria-hidden="true" tabindex="-1"></a>mae_dept_1 <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1 <span class="op">-</span> dept_1_forecast))</span>
<span id="cb47-771"><a href="#cb47-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-772"><a href="#cb47-772" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 Disaggregated Forecast Performance (Method 2):"</span>)</span>
<span id="cb47-773"><a href="#cb47-773" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test TSE:  </span><span class="sc">{</span>tse_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-774"><a href="#cb47-774" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test RMSE: </span><span class="sc">{</span>rmse_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-775"><a href="#cb47-775" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test MAE:  </span><span class="sc">{</span>mae_dept_1<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-776"><a href="#cb47-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-777"><a href="#cb47-777" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb47-778"><a href="#cb47-778" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train_plot <span class="op">=</span> df_store_1_train[</span>
<span id="cb47-779"><a href="#cb47-779" aria-hidden="true" tabindex="-1"></a>    (df_store_1_train[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df_store_1_train[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb47-780"><a href="#cb47-780" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb47-781"><a href="#cb47-781" aria-hidden="true" tabindex="-1"></a>store_1_dept_1_train_plot <span class="op">=</span> store_1_dept_1_train_plot.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb47-782"><a href="#cb47-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-783"><a href="#cb47-783" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-784"><a href="#cb47-784" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_train_plot[<span class="st">'Date'</span>],</span>
<span id="cb47-785"><a href="#cb47-785" aria-hidden="true" tabindex="-1"></a>         store_1_dept_1_train_plot[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb47-786"><a href="#cb47-786" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data (Dept 1)'</span>,</span>
<span id="cb47-787"><a href="#cb47-787" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-788"><a href="#cb47-788" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb47-789"><a href="#cb47-789" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-790"><a href="#cb47-790" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-791"><a href="#cb47-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-792"><a href="#cb47-792" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-793"><a href="#cb47-793" aria-hidden="true" tabindex="-1"></a>         y_test_dept_1,</span>
<span id="cb47-794"><a href="#cb47-794" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data (Dept 1)'</span>,</span>
<span id="cb47-795"><a href="#cb47-795" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-796"><a href="#cb47-796" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb47-797"><a href="#cb47-797" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-798"><a href="#cb47-798" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-799"><a href="#cb47-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-800"><a href="#cb47-800" aria-hidden="true" tabindex="-1"></a>plt.plot(store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-801"><a href="#cb47-801" aria-hidden="true" tabindex="-1"></a>         dept_1_forecast,</span>
<span id="cb47-802"><a href="#cb47-802" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Disaggregated Forecast (Method 2)'</span>,</span>
<span id="cb47-803"><a href="#cb47-803" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-804"><a href="#cb47-804" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'green'</span>,</span>
<span id="cb47-805"><a href="#cb47-805" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-806"><a href="#cb47-806" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-807"><a href="#cb47-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-808"><a href="#cb47-808" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-809"><a href="#cb47-809" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-810"><a href="#cb47-810" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Department 1: Disaggregated Forecast vs Actuals (Method 2)'</span>, </span>
<span id="cb47-811"><a href="#cb47-811" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-812"><a href="#cb47-812" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-813"><a href="#cb47-813" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-814"><a href="#cb47-814" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-815"><a href="#cb47-815" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-816"><a href="#cb47-816" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-817"><a href="#cb47-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-818"><a href="#cb47-818" aria-hidden="true" tabindex="-1"></a><span class="co"># Store Method 2 results</span></span>
<span id="cb47-819"><a href="#cb47-819" aria-hidden="true" tabindex="-1"></a>method2_results <span class="op">=</span> {</span>
<span id="cb47-820"><a href="#cb47-820" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_dept_1,</span>
<span id="cb47-821"><a href="#cb47-821" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_dept_1,</span>
<span id="cb47-822"><a href="#cb47-822" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_dept_1,</span>
<span id="cb47-823"><a href="#cb47-823" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: dept_1_forecast.copy()</span>
<span id="cb47-824"><a href="#cb47-824" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-825"><a href="#cb47-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-826"><a href="#cb47-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-827"><a href="#cb47-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-828"><a href="#cb47-828" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-829"><a href="#cb47-829" aria-hidden="true" tabindex="-1"></a><span class="fu">## Notes</span></span>
<span id="cb47-830"><a href="#cb47-830" aria-hidden="true" tabindex="-1"></a>From the above graph, we can see that the forecasted sales for department 1 using the aggregate-then-disaggregate method does not capture the actual sales pattern very well. The forecasted values are significantly lower than the actual sales during the 3/4 of the test period, indicating that this method may not be effective for department-level forecasting in this case.</span>
<span id="cb47-831"><a href="#cb47-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-832"><a href="#cb47-832" aria-hidden="true" tabindex="-1"></a>We expect that Method 1 (direct forecasting at the department level) will outperform Method 2 (aggregate-then-disaggregate) for department-level forecasts. This is because Method 1 can capture department-specific trends and seasonal patterns that are lost when aggregating sales across all departments in Method 2. As a result, we anticipate lower forecast errors (e.g., RMSE) for Method 1 compared to Method 2 when evaluating at the department level.</span>
<span id="cb47-833"><a href="#cb47-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-834"><a href="#cb47-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-835"><a href="#cb47-835" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-836"><a href="#cb47-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-837"><a href="#cb47-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-838"><a href="#cb47-838" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-839"><a href="#cb47-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-840"><a href="#cb47-840" aria-hidden="true" tabindex="-1"></a><span class="fu"># Method 1: Direct Department-Level Forecasting</span></span>
<span id="cb47-841"><a href="#cb47-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-842"><a href="#cb47-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Preparation</span></span>
<span id="cb47-843"><a href="#cb47-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-846"><a href="#cb47-846" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-847"><a href="#cb47-847" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Store 1, Department 1</span></span>
<span id="cb47-848"><a href="#cb47-848" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1 <span class="op">=</span> df[(df[<span class="st">'Store'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'Dept'</span>] <span class="op">==</span> <span class="dv">1</span>)].copy()</span>
<span id="cb47-849"><a href="#cb47-849" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1 <span class="op">=</span> make_negative_values_zero(df_store_1_dept_1, <span class="st">"Weekly_Sales"</span>)</span>
<span id="cb47-850"><a href="#cb47-850" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df_store_1_dept_1[<span class="st">'Date'</span>])</span>
<span id="cb47-851"><a href="#cb47-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-852"><a href="#cb47-852" aria-hidden="true" tabindex="-1"></a><span class="co"># Split train/test</span></span>
<span id="cb47-853"><a href="#cb47-853" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_train <span class="op">=</span> df_store_1_dept_1[df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">&lt;</span> test_start_date].copy()</span>
<span id="cb47-854"><a href="#cb47-854" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_test <span class="op">=</span> df_store_1_dept_1[df_store_1_dept_1[<span class="st">'Date'</span>] <span class="op">&gt;=</span> test_start_date].copy()</span>
<span id="cb47-855"><a href="#cb47-855" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_train <span class="op">=</span> df_store_1_dept_1_train.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb47-856"><a href="#cb47-856" aria-hidden="true" tabindex="-1"></a>df_store_1_dept_1_test <span class="op">=</span> df_store_1_dept_1_test.sort_values(<span class="st">'Date'</span>)</span>
<span id="cb47-857"><a href="#cb47-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-858"><a href="#cb47-858" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 training data shape: </span><span class="sc">{</span>df_store_1_dept_1_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-859"><a href="#cb47-859" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Department 1 test data shape: </span><span class="sc">{</span>df_store_1_dept_1_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-860"><a href="#cb47-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-861"><a href="#cb47-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-862"><a href="#cb47-862" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualization</span></span>
<span id="cb47-863"><a href="#cb47-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-866"><a href="#cb47-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-867"><a href="#cb47-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dept1-raw</span></span>
<span id="cb47-868"><a href="#cb47-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Store 1, Department 1: Raw Weekly Sales Data"</span></span>
<span id="cb47-869"><a href="#cb47-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-870"><a href="#cb47-870" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-871"><a href="#cb47-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-872"><a href="#cb47-872" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_train[<span class="st">'Date'</span>],</span>
<span id="cb47-873"><a href="#cb47-873" aria-hidden="true" tabindex="-1"></a>         df_store_1_dept_1_train[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb47-874"><a href="#cb47-874" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Training Data (Dept 1)'</span>,</span>
<span id="cb47-875"><a href="#cb47-875" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-876"><a href="#cb47-876" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb47-877"><a href="#cb47-877" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-878"><a href="#cb47-878" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-879"><a href="#cb47-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-880"><a href="#cb47-880" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-881"><a href="#cb47-881" aria-hidden="true" tabindex="-1"></a>         df_store_1_dept_1_test[<span class="st">'Weekly_Sales'</span>],</span>
<span id="cb47-882"><a href="#cb47-882" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Test Data (Dept 1)'</span>,</span>
<span id="cb47-883"><a href="#cb47-883" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-884"><a href="#cb47-884" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb47-885"><a href="#cb47-885" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-886"><a href="#cb47-886" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-887"><a href="#cb47-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-888"><a href="#cb47-888" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-889"><a href="#cb47-889" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-890"><a href="#cb47-890" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Department 1: Actual Weekly Sales Over Time'</span>, </span>
<span id="cb47-891"><a href="#cb47-891" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-892"><a href="#cb47-892" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb47-893"><a href="#cb47-893" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-894"><a href="#cb47-894" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-895"><a href="#cb47-895" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-896"><a href="#cb47-896" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-897"><a href="#cb47-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-898"><a href="#cb47-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-899"><a href="#cb47-899" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trend Analysis for Department 1</span></span>
<span id="cb47-900"><a href="#cb47-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-903"><a href="#cb47-903" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-904"><a href="#cb47-904" aria-hidden="true" tabindex="-1"></a>analyze_series(df_store_1_dept_1_train[<span class="st">"Weekly_Sales"</span>], </span>
<span id="cb47-905"><a href="#cb47-905" aria-hidden="true" tabindex="-1"></a>               series_name<span class="op">=</span><span class="st">"Store 1, Department 1"</span>)</span>
<span id="cb47-906"><a href="#cb47-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-907"><a href="#cb47-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-908"><a href="#cb47-908" aria-hidden="true" tabindex="-1"></a><span class="fu">## Holt-Winters Forecasting (Additive &amp; Multiplicative)</span></span>
<span id="cb47-909"><a href="#cb47-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-912"><a href="#cb47-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-913"><a href="#cb47-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-method1-both</span></span>
<span id="cb47-914"><a href="#cb47-914" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Method 1: Direct Forecasting - Both Models"</span></span>
<span id="cb47-915"><a href="#cb47-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-916"><a href="#cb47-916" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb47-917"><a href="#cb47-917" aria-hidden="true" tabindex="-1"></a>y_train_dept_1 <span class="op">=</span> df_store_1_dept_1_train[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-918"><a href="#cb47-918" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">52</span></span>
<span id="cb47-919"><a href="#cb47-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-920"><a href="#cb47-920" aria-hidden="true" tabindex="-1"></a><span class="co"># ADDITIVE MODEL</span></span>
<span id="cb47-921"><a href="#cb47-921" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Training Method 1 - Additive Model..."</span>)</span>
<span id="cb47-922"><a href="#cb47-922" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb47-923"><a href="#cb47-923" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-924"><a href="#cb47-924" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-925"><a href="#cb47-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-926"><a href="#cb47-926" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb47-927"><a href="#cb47-927" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb47-928"><a href="#cb47-928" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend(</span>
<span id="cb47-929"><a href="#cb47-929" aria-hidden="true" tabindex="-1"></a>            y_train_dept_1, alpha, gamma, m</span>
<span id="cb47-930"><a href="#cb47-930" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-931"><a href="#cb47-931" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-932"><a href="#cb47-932" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb47-933"><a href="#cb47-933" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train_dept_1[valid_idx], fitted[valid_idx])</span>
<span id="cb47-934"><a href="#cb47-934" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-935"><a href="#cb47-935" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb47-936"><a href="#cb47-936" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb47-937"><a href="#cb47-937" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb47-938"><a href="#cb47-938" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb47-939"><a href="#cb47-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-940"><a href="#cb47-940" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Additive - Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-941"><a href="#cb47-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-942"><a href="#cb47-942" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb47-943"><a href="#cb47-943" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="bu">len</span>(df_store_1_dept_1_test)</span>
<span id="cb47-944"><a href="#cb47-944" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb47-945"><a href="#cb47-945" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb47-946"><a href="#cb47-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-947"><a href="#cb47-947" aria-hidden="true" tabindex="-1"></a>forecast_method1_additive <span class="op">=</span> []</span>
<span id="cb47-948"><a href="#cb47-948" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb47-949"><a href="#cb47-949" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb47-950"><a href="#cb47-950" aria-hidden="true" tabindex="-1"></a>    forecast_method1_additive.append(level <span class="op">+</span> seasonals[seasonal_index])</span>
<span id="cb47-951"><a href="#cb47-951" aria-hidden="true" tabindex="-1"></a>forecast_method1_additive <span class="op">=</span> np.array(forecast_method1_additive)</span>
<span id="cb47-952"><a href="#cb47-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-953"><a href="#cb47-953" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb47-954"><a href="#cb47-954" aria-hidden="true" tabindex="-1"></a>y_test_dept_1_actual <span class="op">=</span> df_store_1_dept_1_test[<span class="st">"Weekly_Sales"</span>].values</span>
<span id="cb47-955"><a href="#cb47-955" aria-hidden="true" tabindex="-1"></a>tse_test_add <span class="op">=</span> TSE(y_test_dept_1_actual, forecast_method1_additive)</span>
<span id="cb47-956"><a href="#cb47-956" aria-hidden="true" tabindex="-1"></a>rmse_test_add <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1_actual <span class="op">-</span> forecast_method1_additive) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb47-957"><a href="#cb47-957" aria-hidden="true" tabindex="-1"></a>mae_test_add <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1_actual <span class="op">-</span> forecast_method1_additive))</span>
<span id="cb47-958"><a href="#cb47-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-959"><a href="#cb47-959" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test_add<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-960"><a href="#cb47-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-961"><a href="#cb47-961" aria-hidden="true" tabindex="-1"></a>method1_additive_results <span class="op">=</span> {</span>
<span id="cb47-962"><a href="#cb47-962" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb47-963"><a href="#cb47-963" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb47-964"><a href="#cb47-964" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb47-965"><a href="#cb47-965" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test_add,</span>
<span id="cb47-966"><a href="#cb47-966" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test_add,</span>
<span id="cb47-967"><a href="#cb47-967" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test_add,</span>
<span id="cb47-968"><a href="#cb47-968" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast_method1_additive.copy()</span>
<span id="cb47-969"><a href="#cb47-969" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-970"><a href="#cb47-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-971"><a href="#cb47-971" aria-hidden="true" tabindex="-1"></a><span class="co"># MULTIPLICATIVE MODEL</span></span>
<span id="cb47-972"><a href="#cb47-972" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training Method 1 - Multiplicative Model..."</span>)</span>
<span id="cb47-973"><a href="#cb47-973" aria-hidden="true" tabindex="-1"></a>best_tse <span class="op">=</span> np.inf</span>
<span id="cb47-974"><a href="#cb47-974" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-975"><a href="#cb47-975" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-976"><a href="#cb47-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-977"><a href="#cb47-977" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> alphas:</span>
<span id="cb47-978"><a href="#cb47-978" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gamma <span class="kw">in</span> gammas:</span>
<span id="cb47-979"><a href="#cb47-979" aria-hidden="true" tabindex="-1"></a>        fitted, level, seasonals <span class="op">=</span> hw_seasonal_no_trend_multiplicative(</span>
<span id="cb47-980"><a href="#cb47-980" aria-hidden="true" tabindex="-1"></a>            y_train_dept_1, alpha, gamma, m</span>
<span id="cb47-981"><a href="#cb47-981" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-982"><a href="#cb47-982" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-983"><a href="#cb47-983" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="op">~</span>np.isnan(fitted)</span>
<span id="cb47-984"><a href="#cb47-984" aria-hidden="true" tabindex="-1"></a>        tse <span class="op">=</span> TSE(y_train_dept_1[valid_idx], fitted[valid_idx])</span>
<span id="cb47-985"><a href="#cb47-985" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-986"><a href="#cb47-986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tse <span class="op">&lt;</span> best_tse:</span>
<span id="cb47-987"><a href="#cb47-987" aria-hidden="true" tabindex="-1"></a>            best_tse <span class="op">=</span> tse</span>
<span id="cb47-988"><a href="#cb47-988" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (alpha, gamma)</span>
<span id="cb47-989"><a href="#cb47-989" aria-hidden="true" tabindex="-1"></a>            best_model <span class="op">=</span> (level, seasonals)</span>
<span id="cb47-990"><a href="#cb47-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-991"><a href="#cb47-991" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Multiplicative - Best parameters: alpha=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, gamma=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-992"><a href="#cb47-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-993"><a href="#cb47-993" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb47-994"><a href="#cb47-994" aria-hidden="true" tabindex="-1"></a>level, seasonals <span class="op">=</span> best_model</span>
<span id="cb47-995"><a href="#cb47-995" aria-hidden="true" tabindex="-1"></a>seasonals <span class="op">=</span> np.array(seasonals)</span>
<span id="cb47-996"><a href="#cb47-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-997"><a href="#cb47-997" aria-hidden="true" tabindex="-1"></a>forecast_method1_multiplicative <span class="op">=</span> []</span>
<span id="cb47-998"><a href="#cb47-998" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb47-999"><a href="#cb47-999" aria-hidden="true" tabindex="-1"></a>    seasonal_index <span class="op">=</span> <span class="bu">len</span>(seasonals) <span class="op">-</span> m <span class="op">+</span> i</span>
<span id="cb47-1000"><a href="#cb47-1000" aria-hidden="true" tabindex="-1"></a>    forecast_method1_multiplicative.append(level <span class="op">*</span> seasonals[seasonal_index])</span>
<span id="cb47-1001"><a href="#cb47-1001" aria-hidden="true" tabindex="-1"></a>forecast_method1_multiplicative <span class="op">=</span> np.array(forecast_method1_multiplicative)</span>
<span id="cb47-1002"><a href="#cb47-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1003"><a href="#cb47-1003" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb47-1004"><a href="#cb47-1004" aria-hidden="true" tabindex="-1"></a>tse_test_mult <span class="op">=</span> TSE(y_test_dept_1_actual, forecast_method1_multiplicative)</span>
<span id="cb47-1005"><a href="#cb47-1005" aria-hidden="true" tabindex="-1"></a>rmse_test_mult <span class="op">=</span> np.sqrt(np.mean((y_test_dept_1_actual <span class="op">-</span> forecast_method1_multiplicative) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb47-1006"><a href="#cb47-1006" aria-hidden="true" tabindex="-1"></a>mae_test_mult <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test_dept_1_actual <span class="op">-</span> forecast_method1_multiplicative))</span>
<span id="cb47-1007"><a href="#cb47-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1008"><a href="#cb47-1008" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test RMSE: </span><span class="sc">{</span>rmse_test_mult<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb47-1009"><a href="#cb47-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1010"><a href="#cb47-1010" aria-hidden="true" tabindex="-1"></a>method1_multiplicative_results <span class="op">=</span> {</span>
<span id="cb47-1011"><a href="#cb47-1011" aria-hidden="true" tabindex="-1"></a>    <span class="st">'alpha'</span>: best_params[<span class="dv">0</span>],</span>
<span id="cb47-1012"><a href="#cb47-1012" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: best_params[<span class="dv">1</span>],</span>
<span id="cb47-1013"><a href="#cb47-1013" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_train'</span>: best_tse,</span>
<span id="cb47-1014"><a href="#cb47-1014" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tse_test'</span>: tse_test_mult,</span>
<span id="cb47-1015"><a href="#cb47-1015" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rmse_test'</span>: rmse_test_mult,</span>
<span id="cb47-1016"><a href="#cb47-1016" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mae_test'</span>: mae_test_mult,</span>
<span id="cb47-1017"><a href="#cb47-1017" aria-hidden="true" tabindex="-1"></a>    <span class="st">'forecast'</span>: forecast_method1_multiplicative.copy()</span>
<span id="cb47-1018"><a href="#cb47-1018" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-1019"><a href="#cb47-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1020"><a href="#cb47-1020" aria-hidden="true" tabindex="-1"></a><span class="co"># Select better model for comparison</span></span>
<span id="cb47-1021"><a href="#cb47-1021" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> method1_additive_results[<span class="st">'rmse_test'</span>] <span class="op">&lt;=</span> method1_multiplicative_results[<span class="st">'rmse_test'</span>]:</span>
<span id="cb47-1022"><a href="#cb47-1022" aria-hidden="true" tabindex="-1"></a>    method1_results <span class="op">=</span> method1_additive_results</span>
<span id="cb47-1023"><a href="#cb47-1023" aria-hidden="true" tabindex="-1"></a>    method1_type <span class="op">=</span> <span class="st">"Additive"</span></span>
<span id="cb47-1024"><a href="#cb47-1024" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb47-1025"><a href="#cb47-1025" aria-hidden="true" tabindex="-1"></a>    method1_results <span class="op">=</span> method1_multiplicative_results</span>
<span id="cb47-1026"><a href="#cb47-1026" aria-hidden="true" tabindex="-1"></a>    method1_type <span class="op">=</span> <span class="st">"Multiplicative"</span></span>
<span id="cb47-1027"><a href="#cb47-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1028"><a href="#cb47-1028" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Selected for comparison: </span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss"> model"</span>)</span>
<span id="cb47-1029"><a href="#cb47-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1030"><a href="#cb47-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1031"><a href="#cb47-1031" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1032"><a href="#cb47-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1033"><a href="#cb47-1033" aria-hidden="true" tabindex="-1"></a><span class="fu"># Final Comparison: Method 1 vs Method 2</span></span>
<span id="cb47-1034"><a href="#cb47-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1035"><a href="#cb47-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Metrics</span></span>
<span id="cb47-1036"><a href="#cb47-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1039"><a href="#cb47-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-1040"><a href="#cb47-1040" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-final-comparison</span></span>
<span id="cb47-1041"><a href="#cb47-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Final Performance Comparison: Method 1 vs Method 2"</span></span>
<span id="cb47-1042"><a href="#cb47-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1043"><a href="#cb47-1043" aria-hidden="true" tabindex="-1"></a>comparison_final <span class="op">=</span> pd.DataFrame({</span>
<span id="cb47-1044"><a href="#cb47-1044" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Metric'</span>: [<span class="st">'TSE'</span>, <span class="st">'RMSE'</span>, <span class="st">'MAE'</span>],</span>
<span id="cb47-1045"><a href="#cb47-1045" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Method 1 (Direct)'</span>: [</span>
<span id="cb47-1046"><a href="#cb47-1046" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1047"><a href="#cb47-1047" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1048"><a href="#cb47-1048" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method1_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb47-1049"><a href="#cb47-1049" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb47-1050"><a href="#cb47-1050" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Method 2 (Disaggregate)'</span>: [</span>
<span id="cb47-1051"><a href="#cb47-1051" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'tse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1052"><a href="#cb47-1052" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'rmse_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1053"><a href="#cb47-1053" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'mae_test'</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb47-1054"><a href="#cb47-1054" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb47-1055"><a href="#cb47-1055" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Difference (M2 - M1)'</span>: [</span>
<span id="cb47-1056"><a href="#cb47-1056" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'tse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'tse_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1057"><a href="#cb47-1057" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'rmse_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span>,</span>
<span id="cb47-1058"><a href="#cb47-1058" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>method2_results[<span class="st">'mae_test'</span>] <span class="op">-</span> method1_results[<span class="st">'mae_test'</span>]<span class="sc">:+.2f}</span><span class="ss">"</span></span>
<span id="cb47-1059"><a href="#cb47-1059" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb47-1060"><a href="#cb47-1060" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-1061"><a href="#cb47-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1062"><a href="#cb47-1062" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_final.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb47-1063"><a href="#cb47-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1064"><a href="#cb47-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine winner</span></span>
<span id="cb47-1065"><a href="#cb47-1065" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> method1_results[<span class="st">'rmse_test'</span>] <span class="op">&lt;</span> method2_results[<span class="st">'rmse_test'</span>]:</span>
<span id="cb47-1066"><a href="#cb47-1066" aria-hidden="true" tabindex="-1"></a>    better_method <span class="op">=</span> <span class="st">"METHOD 1 (Direct Forecasting)"</span></span>
<span id="cb47-1067"><a href="#cb47-1067" aria-hidden="true" tabindex="-1"></a>    rmse_improvement <span class="op">=</span> method2_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method1_results[<span class="st">'rmse_test'</span>]</span>
<span id="cb47-1068"><a href="#cb47-1068" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb47-1069"><a href="#cb47-1069" aria-hidden="true" tabindex="-1"></a>    better_method <span class="op">=</span> <span class="st">"METHOD 2 (Disaggregation)"</span></span>
<span id="cb47-1070"><a href="#cb47-1070" aria-hidden="true" tabindex="-1"></a>    rmse_improvement <span class="op">=</span> method1_results[<span class="st">'rmse_test'</span>] <span class="op">-</span> method2_results[<span class="st">'rmse_test'</span>]</span>
<span id="cb47-1071"><a href="#cb47-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1072"><a href="#cb47-1072" aria-hidden="true" tabindex="-1"></a>improvement_pct <span class="op">=</span> (rmse_improvement <span class="op">/</span> <span class="bu">max</span>(method1_results[<span class="st">'rmse_test'</span>], method2_results[<span class="st">'rmse_test'</span>])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb47-1073"><a href="#cb47-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1074"><a href="#cb47-1074" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1075"><a href="#cb47-1075" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"WINNER: </span><span class="sc">{</span>better_method<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1076"><a href="#cb47-1076" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE Improvement: </span><span class="sc">{</span>rmse_improvement<span class="sc">:.2f}</span><span class="ss"> (</span><span class="sc">{</span>improvement_pct<span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb47-1077"><a href="#cb47-1077" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1078"><a href="#cb47-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1079"><a href="#cb47-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1080"><a href="#cb47-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visual Comparison</span></span>
<span id="cb47-1081"><a href="#cb47-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1084"><a href="#cb47-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-1085"><a href="#cb47-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-final-comparison</span></span>
<span id="cb47-1086"><a href="#cb47-1086" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Final Forecast Comparison: Method 1 vs Method 2"</span></span>
<span id="cb47-1087"><a href="#cb47-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1088"><a href="#cb47-1088" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb47-1089"><a href="#cb47-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1090"><a href="#cb47-1090" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>], </span>
<span id="cb47-1091"><a href="#cb47-1091" aria-hidden="true" tabindex="-1"></a>         y_test_dept_1_actual,</span>
<span id="cb47-1092"><a href="#cb47-1092" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Actual Test Data'</span>,</span>
<span id="cb47-1093"><a href="#cb47-1093" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-1094"><a href="#cb47-1094" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb47-1095"><a href="#cb47-1095" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb47-1096"><a href="#cb47-1096" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb47-1097"><a href="#cb47-1097" aria-hidden="true" tabindex="-1"></a>         zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb47-1098"><a href="#cb47-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1099"><a href="#cb47-1099" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1100"><a href="#cb47-1100" aria-hidden="true" tabindex="-1"></a>         method1_results[<span class="st">'forecast'</span>],</span>
<span id="cb47-1101"><a href="#cb47-1101" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="ss">f'Method 1: Direct Forecasting (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb47-1102"><a href="#cb47-1102" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb47-1103"><a href="#cb47-1103" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1104"><a href="#cb47-1104" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb47-1105"><a href="#cb47-1105" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb47-1106"><a href="#cb47-1106" aria-hidden="true" tabindex="-1"></a>         alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1107"><a href="#cb47-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1108"><a href="#cb47-1108" aria-hidden="true" tabindex="-1"></a>plt.plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1109"><a href="#cb47-1109" aria-hidden="true" tabindex="-1"></a>         method2_results[<span class="st">'forecast'</span>],</span>
<span id="cb47-1110"><a href="#cb47-1110" aria-hidden="true" tabindex="-1"></a>         label<span class="op">=</span><span class="st">'Method 2: Disaggregation'</span>,</span>
<span id="cb47-1111"><a href="#cb47-1111" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'^'</span>,</span>
<span id="cb47-1112"><a href="#cb47-1112" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1113"><a href="#cb47-1113" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb47-1114"><a href="#cb47-1114" aria-hidden="true" tabindex="-1"></a>         markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb47-1115"><a href="#cb47-1115" aria-hidden="true" tabindex="-1"></a>         alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb47-1116"><a href="#cb47-1116" aria-hidden="true" tabindex="-1"></a>         linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb47-1117"><a href="#cb47-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1118"><a href="#cb47-1118" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1119"><a href="#cb47-1119" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Weekly Sales ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1120"><a href="#cb47-1120" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Store 1, Dept 1: Method 1 vs Method 2 Forecast Comparison'</span>, </span>
<span id="cb47-1121"><a href="#cb47-1121" aria-hidden="true" tabindex="-1"></a>          fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1122"><a href="#cb47-1122" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">11</span>, loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb47-1123"><a href="#cb47-1123" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-1124"><a href="#cb47-1124" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-1125"><a href="#cb47-1125" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-1126"><a href="#cb47-1126" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-1127"><a href="#cb47-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1128"><a href="#cb47-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1129"><a href="#cb47-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Forecast Errors Analysis</span></span>
<span id="cb47-1130"><a href="#cb47-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1133"><a href="#cb47-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-1134"><a href="#cb47-1134" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-errors</span></span>
<span id="cb47-1135"><a href="#cb47-1135" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Forecast Errors Over Time"</span></span>
<span id="cb47-1136"><a href="#cb47-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1137"><a href="#cb47-1137" aria-hidden="true" tabindex="-1"></a>errors_method1 <span class="op">=</span> y_test_dept_1_actual <span class="op">-</span> method1_results[<span class="st">'forecast'</span>]</span>
<span id="cb47-1138"><a href="#cb47-1138" aria-hidden="true" tabindex="-1"></a>errors_method2 <span class="op">=</span> y_test_dept_1_actual <span class="op">-</span> method2_results[<span class="st">'forecast'</span>]</span>
<span id="cb47-1139"><a href="#cb47-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1140"><a href="#cb47-1140" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb47-1141"><a href="#cb47-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1142"><a href="#cb47-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 1: Forecast Errors</span></span>
<span id="cb47-1143"><a href="#cb47-1143" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1144"><a href="#cb47-1144" aria-hidden="true" tabindex="-1"></a>             errors_method1,</span>
<span id="cb47-1145"><a href="#cb47-1145" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Method 1 Errors (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>,</span>
<span id="cb47-1146"><a href="#cb47-1146" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-1147"><a href="#cb47-1147" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1148"><a href="#cb47-1148" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb47-1149"><a href="#cb47-1149" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1150"><a href="#cb47-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1151"><a href="#cb47-1151" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1152"><a href="#cb47-1152" aria-hidden="true" tabindex="-1"></a>             errors_method2,</span>
<span id="cb47-1153"><a href="#cb47-1153" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">'Method 2 Errors'</span>,</span>
<span id="cb47-1154"><a href="#cb47-1154" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb47-1155"><a href="#cb47-1155" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1156"><a href="#cb47-1156" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb47-1157"><a href="#cb47-1157" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1158"><a href="#cb47-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1159"><a href="#cb47-1159" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-1160"><a href="#cb47-1160" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1161"><a href="#cb47-1161" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Forecast Error ($)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1162"><a href="#cb47-1162" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Forecast Errors: Method 1 vs Method 2'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1163"><a href="#cb47-1163" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb47-1164"><a href="#cb47-1164" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-1165"><a href="#cb47-1165" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-1166"><a href="#cb47-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1167"><a href="#cb47-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># Subplot 2: Absolute Errors</span></span>
<span id="cb47-1168"><a href="#cb47-1168" aria-hidden="true" tabindex="-1"></a>abs_errors_method1 <span class="op">=</span> np.<span class="bu">abs</span>(errors_method1)</span>
<span id="cb47-1169"><a href="#cb47-1169" aria-hidden="true" tabindex="-1"></a>abs_errors_method2 <span class="op">=</span> np.<span class="bu">abs</span>(errors_method2)</span>
<span id="cb47-1170"><a href="#cb47-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1171"><a href="#cb47-1171" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1172"><a href="#cb47-1172" aria-hidden="true" tabindex="-1"></a>             abs_errors_method1,</span>
<span id="cb47-1173"><a href="#cb47-1173" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Method 1 Absolute Errors'</span>,</span>
<span id="cb47-1174"><a href="#cb47-1174" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'o'</span>,</span>
<span id="cb47-1175"><a href="#cb47-1175" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1176"><a href="#cb47-1176" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb47-1177"><a href="#cb47-1177" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1178"><a href="#cb47-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1179"><a href="#cb47-1179" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(df_store_1_dept_1_test[<span class="st">'Date'</span>],</span>
<span id="cb47-1180"><a href="#cb47-1180" aria-hidden="true" tabindex="-1"></a>             abs_errors_method2,</span>
<span id="cb47-1181"><a href="#cb47-1181" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="st">'Method 2 Absolute Errors'</span>,</span>
<span id="cb47-1182"><a href="#cb47-1182" aria-hidden="true" tabindex="-1"></a>             marker<span class="op">=</span><span class="st">'s'</span>,</span>
<span id="cb47-1183"><a href="#cb47-1183" aria-hidden="true" tabindex="-1"></a>             linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb47-1184"><a href="#cb47-1184" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb47-1185"><a href="#cb47-1185" aria-hidden="true" tabindex="-1"></a>             alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1186"><a href="#cb47-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1187"><a href="#cb47-1187" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span>method1_results[<span class="st">'mae_test'</span>], color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb47-1188"><a href="#cb47-1188" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="ss">f'Method 1 MAE: </span><span class="sc">{</span>method1_results[<span class="st">"mae_test"</span>]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb47-1189"><a href="#cb47-1189" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span>method2_results[<span class="st">'mae_test'</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, </span>
<span id="cb47-1190"><a href="#cb47-1190" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="ss">f'Method 2 MAE: </span><span class="sc">{</span>method2_results[<span class="st">"mae_test"</span>]<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb47-1191"><a href="#cb47-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1192"><a href="#cb47-1192" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1193"><a href="#cb47-1193" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Absolute Error ($)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1194"><a href="#cb47-1194" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Absolute Forecast Errors: Method 1 vs Method 2'</span>, fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1195"><a href="#cb47-1195" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb47-1196"><a href="#cb47-1196" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb47-1197"><a href="#cb47-1197" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-1198"><a href="#cb47-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1199"><a href="#cb47-1199" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-1200"><a href="#cb47-1200" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-1201"><a href="#cb47-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1202"><a href="#cb47-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1203"><a href="#cb47-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Metrics Bar Chart</span></span>
<span id="cb47-1204"><a href="#cb47-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1207"><a href="#cb47-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-1208"><a href="#cb47-1208" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-metrics-bar</span></span>
<span id="cb47-1209"><a href="#cb47-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Performance Metrics Comparison"</span></span>
<span id="cb47-1210"><a href="#cb47-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1211"><a href="#cb47-1211" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">'TSE'</span>, <span class="st">'RMSE'</span>, <span class="st">'MAE'</span>]</span>
<span id="cb47-1212"><a href="#cb47-1212" aria-hidden="true" tabindex="-1"></a>method1_values <span class="op">=</span> [method1_results[<span class="st">'tse_test'</span>], method1_results[<span class="st">'rmse_test'</span>], method1_results[<span class="st">'mae_test'</span>]]</span>
<span id="cb47-1213"><a href="#cb47-1213" aria-hidden="true" tabindex="-1"></a>method2_values <span class="op">=</span> [method2_results[<span class="st">'tse_test'</span>], method2_results[<span class="st">'rmse_test'</span>], method2_results[<span class="st">'mae_test'</span>]]</span>
<span id="cb47-1214"><a href="#cb47-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1215"><a href="#cb47-1215" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(metrics))</span>
<span id="cb47-1216"><a href="#cb47-1216" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb47-1217"><a href="#cb47-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1218"><a href="#cb47-1218" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb47-1219"><a href="#cb47-1219" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, method1_values, width, label<span class="op">=</span><span class="ss">f'Method 1 (</span><span class="sc">{</span>method1_type<span class="sc">}</span><span class="ss">)'</span>, </span>
<span id="cb47-1220"><a href="#cb47-1220" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1221"><a href="#cb47-1221" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, method2_values, width, label<span class="op">=</span><span class="st">'Method 2 (Disaggregation)'</span>, </span>
<span id="cb47-1222"><a href="#cb47-1222" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb47-1223"><a href="#cb47-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1224"><a href="#cb47-1224" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Metrics'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1225"><a href="#cb47-1225" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Value'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1226"><a href="#cb47-1226" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Forecast Performance Comparison: Method 1 vs Method 2'</span>, </span>
<span id="cb47-1227"><a href="#cb47-1227" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-1228"><a href="#cb47-1228" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(x)</span>
<span id="cb47-1229"><a href="#cb47-1229" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(metrics)</span>
<span id="cb47-1230"><a href="#cb47-1230" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb47-1231"><a href="#cb47-1231" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb47-1232"><a href="#cb47-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1233"><a href="#cb47-1233" aria-hidden="true" tabindex="-1"></a><span class="co"># Add value labels</span></span>
<span id="cb47-1234"><a href="#cb47-1234" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bars <span class="kw">in</span> [bars1, bars2]:</span>
<span id="cb47-1235"><a href="#cb47-1235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb47-1236"><a href="#cb47-1236" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> bar.get_height()</span>
<span id="cb47-1237"><a href="#cb47-1237" aria-hidden="true" tabindex="-1"></a>        ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height,</span>
<span id="cb47-1238"><a href="#cb47-1238" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb47-1239"><a href="#cb47-1239" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb47-1240"><a href="#cb47-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1241"><a href="#cb47-1241" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-1242"><a href="#cb47-1242" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-1243"><a href="#cb47-1243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1244"><a href="#cb47-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1245"><a href="#cb47-1245" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1246"><a href="#cb47-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1247"><a href="#cb47-1247" aria-hidden="true" tabindex="-1"></a><span class="fu"># Understanding the Evaluation Metrics</span></span>
<span id="cb47-1248"><a href="#cb47-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1249"><a href="#cb47-1249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why TSE, RMSE, and MAE?</span></span>
<span id="cb47-1250"><a href="#cb47-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1251"><a href="#cb47-1251" aria-hidden="true" tabindex="-1"></a>We use three complementary metrics to comprehensively evaluate forecast quality:</span>
<span id="cb47-1252"><a href="#cb47-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1253"><a href="#cb47-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Total Squared Error (TSE)</span></span>
<span id="cb47-1254"><a href="#cb47-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1255"><a href="#cb47-1255" aria-hidden="true" tabindex="-1"></a>$$\text{TSE} = \sum_{t=1}^{n} (y_t - \hat{y}_t)^2$$</span>
<span id="cb47-1256"><a href="#cb47-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1257"><a href="#cb47-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Aggregated loss function across all test periods</span>
<span id="cb47-1258"><a href="#cb47-1258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Optimization criterion used during model training</span>
<span id="cb47-1259"><a href="#cb47-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Heavily penalizes large errors (squared term)</span>
<span id="cb47-1260"><a href="#cb47-1260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maintains original units² (dollars²)</span>
<span id="cb47-1261"><a href="#cb47-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1262"><a href="#cb47-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Root Mean Squared Error (RMSE)</span></span>
<span id="cb47-1263"><a href="#cb47-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1264"><a href="#cb47-1264" aria-hidden="true" tabindex="-1"></a>$$\text{RMSE} = \sqrt{\frac{1}{n}\sum_{t=1}^{n} (y_t - \hat{y}_t)^2}$$</span>
<span id="cb47-1265"><a href="#cb47-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1266"><a href="#cb47-1266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Returns to original units (dollars) for interpretability</span>
<span id="cb47-1267"><a href="#cb47-1267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Standard metric in forecasting literature</span>
<span id="cb47-1268"><a href="#cb47-1268" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Penalizes large errors more than small ones</span>
<span id="cb47-1269"><a href="#cb47-1269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Normalized by sample size</span>
<span id="cb47-1270"><a href="#cb47-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1271"><a href="#cb47-1271" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Mean Absolute Error (MAE)</span></span>
<span id="cb47-1272"><a href="#cb47-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1273"><a href="#cb47-1273" aria-hidden="true" tabindex="-1"></a>$$\text{MAE} = \frac{1}{n}\sum_{t=1}^{n} |y_t - \hat{y}_t|$$</span>
<span id="cb47-1274"><a href="#cb47-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1275"><a href="#cb47-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Robust to outliers (no squaring)</span>
<span id="cb47-1276"><a href="#cb47-1276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Represents average absolute deviation</span>
<span id="cb47-1277"><a href="#cb47-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear penalty (all errors weighted equally)</span>
<span id="cb47-1278"><a href="#cb47-1278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Intuitive interpretation</span>
<span id="cb47-1279"><a href="#cb47-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1280"><a href="#cb47-1280" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Not MAPE?</span></span>
<span id="cb47-1281"><a href="#cb47-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1282"><a href="#cb47-1282" aria-hidden="true" tabindex="-1"></a>We avoid MAPE (Mean Absolute Percentage Error) because:</span>
<span id="cb47-1283"><a href="#cb47-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1284"><a href="#cb47-1284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Undefined/infinite when actual values are zero or near-zero</span>
<span id="cb47-1285"><a href="#cb47-1285" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Asymmetric (over-predictions penalized more than under-predictions)</span>
<span id="cb47-1286"><a href="#cb47-1286" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not suitable for data with varying scales</span>
<span id="cb47-1287"><a href="#cb47-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1288"><a href="#cb47-1288" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting the Relationship</span></span>
<span id="cb47-1289"><a href="#cb47-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1290"><a href="#cb47-1290" aria-hidden="true" tabindex="-1"></a>**If RMSE &gt;&gt; MAE**: Large outlier errors dominate</span>
<span id="cb47-1291"><a href="#cb47-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1292"><a href="#cb47-1292" aria-hidden="true" tabindex="-1"></a>**If RMSE ≈ MAE**: Errors are relatively consistent</span>
<span id="cb47-1293"><a href="#cb47-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1294"><a href="#cb47-1294" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1295"><a href="#cb47-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1296"><a href="#cb47-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1297"><a href="#cb47-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison Additive vs Multiplicative Seasonality (Theory)</span></span>
<span id="cb47-1298"><a href="#cb47-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1299"><a href="#cb47-1299" aria-hidden="true" tabindex="-1"></a>| Additive | Multiplicative</span>
<span id="cb47-1300"><a href="#cb47-1300" aria-hidden="true" tabindex="-1"></a>|--------|-----------</span>
<span id="cb47-1301"><a href="#cb47-1301" aria-hidden="true" tabindex="-1"></a>| Seasonality is independent of the series level | Seasonality scales with the level </span>
<span id="cb47-1302"><a href="#cb47-1302" aria-hidden="true" tabindex="-1"></a>| Peaks and dips are about the same size every season   | Peaks get bigger when the series gets bigger</span>
<span id="cb47-1303"><a href="#cb47-1303" aria-hidden="true" tabindex="-1"></a>| E.g. Temperature Time Series, rainfall in mm, energy usage in kWh  | Retail sales, revenue, website traffic</span>
<span id="cb47-1304"><a href="#cb47-1304" aria-hidden="true" tabindex="-1"></a>| If seasonality looks like a fixed number | If it looks like a fixed percentage</span>
<span id="cb47-1305"><a href="#cb47-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1306"><a href="#cb47-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1307"><a href="#cb47-1307" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusions</span></span>
<span id="cb47-1308"><a href="#cb47-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1309"><a href="#cb47-1309" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Findings</span></span>
<span id="cb47-1310"><a href="#cb47-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1311"><a href="#cb47-1311" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb47-1312"><a href="#cb47-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">## Primary Result</span></span>
<span id="cb47-1313"><a href="#cb47-1313" aria-hidden="true" tabindex="-1"></a>**Method 2 (Aggregate-then-Disaggregate) outperformed Method 1 (Direct Forecasting)** with an RMSE improvement of **15.22 (3.96%)** for Store 1, Department 1.</span>
<span id="cb47-1314"><a href="#cb47-1314" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-1315"><a href="#cb47-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1316"><a href="#cb47-1316" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Did Method 2 Win?</span></span>
<span id="cb47-1317"><a href="#cb47-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1318"><a href="#cb47-1318" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Noise Reduction**: Aggregating across departments smoothed volatility and irregular patterns</span>
<span id="cb47-1319"><a href="#cb47-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Stable Proportions**: Department 1 maintained a consistent share of total store sales</span>
<span id="cb47-1320"><a href="#cb47-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Stronger Signal**: Store-level seasonal patterns were clearer and more predictable</span>
<span id="cb47-1321"><a href="#cb47-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1322"><a href="#cb47-1322" aria-hidden="true" tabindex="-1"></a><span class="fu">### When Would Method 1 Be Better?</span></span>
<span id="cb47-1323"><a href="#cb47-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1324"><a href="#cb47-1324" aria-hidden="true" tabindex="-1"></a>Method 1 (Direct Forecasting) would likely outperform Method 2 in scenarios with:</span>
<span id="cb47-1325"><a href="#cb47-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1326"><a href="#cb47-1326" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Unique Seasonal Patterns**: Departments with seasonality different from the store average</span>
<span id="cb47-1327"><a href="#cb47-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Structural Changes**: Recent department-specific events (renovations, new product lines)</span>
<span id="cb47-1328"><a href="#cb47-1328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Unstable Proportions**: Departments whose share of store sales fluctuates significantly</span>
<span id="cb47-1329"><a href="#cb47-1329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Large Departments**: Departments representing substantial portions of store sales with distinct behavior</span>
<span id="cb47-1330"><a href="#cb47-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1331"><a href="#cb47-1331" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generalizability</span></span>
<span id="cb47-1332"><a href="#cb47-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1333"><a href="#cb47-1333" aria-hidden="true" tabindex="-1"></a>This analysis suggests **Method 2 may be preferred** for:</span>
<span id="cb47-1334"><a href="#cb47-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1335"><a href="#cb47-1335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stable, mature departments with consistent historical patterns</span>
<span id="cb47-1336"><a href="#cb47-1336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Departments representing small, steady shares of total store sales</span>
<span id="cb47-1337"><a href="#cb47-1337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scenarios where reducing forecast variance is critical (e.g., inventory planning)</span>
<span id="cb47-1338"><a href="#cb47-1338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Contexts with limited department-specific data</span>
<span id="cb47-1339"><a href="#cb47-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1340"><a href="#cb47-1340" aria-hidden="true" tabindex="-1"></a>**Method 1 may be preferred** for:</span>
<span id="cb47-1341"><a href="#cb47-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1342"><a href="#cb47-1342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Large departments with strong individual identity</span>
<span id="cb47-1343"><a href="#cb47-1343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Departments undergoing transformation or growth</span>
<span id="cb47-1344"><a href="#cb47-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Situations requiring granular, department-specific insights</span>
<span id="cb47-1345"><a href="#cb47-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1346"><a href="#cb47-1346" aria-hidden="true" tabindex="-1"></a><span class="fu">## Limitations and Future Work</span></span>
<span id="cb47-1347"><a href="#cb47-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1348"><a href="#cb47-1348" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb47-1349"><a href="#cb47-1349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Study Limitations</span></span>
<span id="cb47-1350"><a href="#cb47-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Analysis limited to Store 1, Department 1</span>
<span id="cb47-1351"><a href="#cb47-1351" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test period covers only 4 weeks</span>
<span id="cb47-1352"><a href="#cb47-1352" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Holt-Winters model does not capture promotional effects or external factors</span>
<span id="cb47-1353"><a href="#cb47-1353" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No cross-validation across multiple departments/stores</span>
<span id="cb47-1354"><a href="#cb47-1354" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-1355"><a href="#cb47-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1356"><a href="#cb47-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommended Extensions</span></span>
<span id="cb47-1357"><a href="#cb47-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1358"><a href="#cb47-1358" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Broader Testing**: Replicate analysis across all stores and departments</span>
<span id="cb47-1359"><a href="#cb47-1359" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Alternative Models**: Test ARIMA, Prophet, LSTM for potential improvements</span>
<span id="cb47-1360"><a href="#cb47-1360" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Exogenous Variables**: Incorporate holidays, promotions, economic indicators</span>
<span id="cb47-1361"><a href="#cb47-1361" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Longer Horizons**: Evaluate forecast accuracy over multi-week periods</span>
<span id="cb47-1362"><a href="#cb47-1362" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Hybrid Approaches**: Combine methods or use ensemble forecasting</span>
<span id="cb47-1363"><a href="#cb47-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1364"><a href="#cb47-1364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Implications</span></span>
<span id="cb47-1365"><a href="#cb47-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1366"><a href="#cb47-1366" aria-hidden="true" tabindex="-1"></a>For **retail forecasting practitioners**:</span>
<span id="cb47-1367"><a href="#cb47-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1368"><a href="#cb47-1368" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Don't assume direct department-level forecasting is always superior</span>
<span id="cb47-1369"><a href="#cb47-1369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test both methods on your specific data before deciding</span>
<span id="cb47-1370"><a href="#cb47-1370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consider department characteristics (size, stability, uniqueness)</span>
<span id="cb47-1371"><a href="#cb47-1371" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Aggregate-then-disaggregate can be surprisingly effective for stable departments</span>
<span id="cb47-1372"><a href="#cb47-1372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Computational efficiency: Method 2 requires fewer models (1 per store vs. 1 per store-department combination)</span>
<span id="cb47-1373"><a href="#cb47-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1374"><a href="#cb47-1374" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1375"><a href="#cb47-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1376"><a href="#cb47-1376" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb47-1377"><a href="#cb47-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1378"><a href="#cb47-1378" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Source</span></span>
<span id="cb47-1379"><a href="#cb47-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1380"><a href="#cb47-1380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Walmart Store Sales Forecasting**: Kaggle Competition Dataset</span>
<span id="cb47-1381"><a href="#cb47-1381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Historical weekly sales data for multiple stores and departments</span>
<span id="cb47-1382"><a href="#cb47-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1383"><a href="#cb47-1383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methodology References</span></span>
<span id="cb47-1384"><a href="#cb47-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1385"><a href="#cb47-1385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Holt, C. C. (2004). "Forecasting seasonals and trends by exponentially weighted moving averages"</span>
<span id="cb47-1386"><a href="#cb47-1386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Winters, P. R. (1960). "Forecasting sales by exponentially weighted moving averages"</span>
<span id="cb47-1387"><a href="#cb47-1387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hyndman, R. J., &amp; Athanasopoulos, G. (2021). "Forecasting: Principles and Practice" (3rd ed.)</span>
<span id="cb47-1388"><a href="#cb47-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1389"><a href="#cb47-1389" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical Tests</span></span>
<span id="cb47-1390"><a href="#cb47-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1391"><a href="#cb47-1391" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Augmented Dickey-Fuller Test for stationarity(We can make some conclusion for trend based on that as well)</span>
<span id="cb47-1392"><a href="#cb47-1392" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>KPSS Test for trend-stationarity (Same logic with ADF test)</span>
<span id="cb47-1393"><a href="#cb47-1393" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mann-Kendall Trend Test(Checking if there is a monotonic trend)</span>
<span id="cb47-1394"><a href="#cb47-1394" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear Regression Slope Test(Is the mean changing linearly with time?)</span>
<span id="cb47-1395"><a href="#cb47-1395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cox-Stuart Test(Is the second half systematically larger than the first?)</span>
<span id="cb47-1396"><a href="#cb47-1396" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Spearman's Rank Correlation Test(Is there any monotonic relationship between time and value?)</span>
<span id="cb47-1397"><a href="#cb47-1397" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1398"><a href="#cb47-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1399"><a href="#cb47-1399" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix: Code Repository</span></span>
<span id="cb47-1400"><a href="#cb47-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1401"><a href="#cb47-1401" aria-hidden="true" tabindex="-1"></a>All code, data, and analysis files are available in the project repository:</span>
<span id="cb47-1402"><a href="#cb47-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1403"><a href="#cb47-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1404"><a href="#cb47-1404" aria-hidden="true" tabindex="-1"></a><span class="in">PROJECT/</span></span>
<span id="cb47-1405"><a href="#cb47-1405" aria-hidden="true" tabindex="-1"></a><span class="in">├── data/</span></span>
<span id="cb47-1406"><a href="#cb47-1406" aria-hidden="true" tabindex="-1"></a><span class="in">│   └── train.csv</span></span>
<span id="cb47-1407"><a href="#cb47-1407" aria-hidden="true" tabindex="-1"></a><span class="in">├──my quarto/</span></span>
<span id="cb47-1408"><a href="#cb47-1408" aria-hidden="true" tabindex="-1"></a><span class="in">    └── Part1.qmd</span></span>
<span id="cb47-1409"><a href="#cb47-1409" aria-hidden="true" tabindex="-1"></a><span class="in">    └──run_trend_analysis.py</span></span>
<span id="cb47-1410"><a href="#cb47-1410" aria-hidden="true" tabindex="-1"></a><span class="in">├──Part1_Comparing_HigherLevel_UnitLevel.ipynb # Same logic, same code with quarto doc</span></span>
<span id="cb47-1411"><a href="#cb47-1411" aria-hidden="true" tabindex="-1"></a><span class="in">└── requirements.txt</span></span>
<span id="cb47-1412"><a href="#cb47-1412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1413"><a href="#cb47-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1414"><a href="#cb47-1414" aria-hidden="true" tabindex="-1"></a><span class="fu">## Requirements</span></span>
<span id="cb47-1415"><a href="#cb47-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1416"><a href="#cb47-1416" aria-hidden="true" tabindex="-1"></a><span class="in">```txt</span></span>
<span id="cb47-1417"><a href="#cb47-1417" aria-hidden="true" tabindex="-1"></a><span class="in">pandas&gt;=1.3.0</span></span>
<span id="cb47-1418"><a href="#cb47-1418" aria-hidden="true" tabindex="-1"></a><span class="in">numpy&gt;=1.21.0</span></span>
<span id="cb47-1419"><a href="#cb47-1419" aria-hidden="true" tabindex="-1"></a><span class="in">matplotlib&gt;=3.4.0</span></span>
<span id="cb47-1420"><a href="#cb47-1420" aria-hidden="true" tabindex="-1"></a><span class="in">seaborn&gt;=0.11.0</span></span>
<span id="cb47-1421"><a href="#cb47-1421" aria-hidden="true" tabindex="-1"></a><span class="in">scipy&gt;=1.7.0</span></span>
<span id="cb47-1422"><a href="#cb47-1422" aria-hidden="true" tabindex="-1"></a><span class="in">statsmodels&gt;=0.13.0</span></span>
<span id="cb47-1423"><a href="#cb47-1423" aria-hidden="true" tabindex="-1"></a><span class="in">pymannkendall&gt;=1.4.0</span></span>
<span id="cb47-1424"><a href="#cb47-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1425"><a href="#cb47-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1426"><a href="#cb47-1426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Information</span></span>
<span id="cb47-1427"><a href="#cb47-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1430"><a href="#cb47-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb47-1431"><a href="#cb47-1431" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb47-1432"><a href="#cb47-1432" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version: </span><span class="sc">{</span>sys<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1433"><a href="#cb47-1433" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pandas version: </span><span class="sc">{</span>pd<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1434"><a href="#cb47-1434" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy version: </span><span class="sc">{</span>np<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-1435"><a href="#cb47-1435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1436"><a href="#cb47-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1437"><a href="#cb47-1437" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb47-1438"><a href="#cb47-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1439"><a href="#cb47-1439" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb47-1440"><a href="#cb47-1440" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reproducibility Note</span></span>
<span id="cb47-1441"><a href="#cb47-1441" aria-hidden="true" tabindex="-1"></a>This entire analysis can be reproduced by running:</span>
<span id="cb47-1442"><a href="#cb47-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1443"><a href="#cb47-1443" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb47-1444"><a href="#cb47-1444" aria-hidden="true" tabindex="-1"></a><span class="ex">quarto</span> render Part1.qmd</span>
<span id="cb47-1445"><a href="#cb47-1445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-1446"><a href="#cb47-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1447"><a href="#cb47-1447" aria-hidden="true" tabindex="-1"></a>All random seeds (if applicable) and data processing steps are documented in the code blocks above.</span>
<span id="cb47-1448"><a href="#cb47-1448" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>